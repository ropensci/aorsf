<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Oblique random forest control"><title>Oblique random forest control — orsf_control • aorsf</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Oblique random forest control — orsf_control"><meta property="og:description" content="Oblique random forest control"><meta property="og:image" content="https://bcjaeger.github.io/aorsf/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aorsf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/aorsf.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pd.html">PD and ICE curves with ORSF</a>
    <a class="dropdown-item" href="../articles/oobag.html">Out-of-bag predictions and evaluation</a>
    <a class="dropdown-item" href="../articles/fast.html">Tips to speed up computation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/aorsf/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Oblique random forest control</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/aorsf/blob/HEAD/R/orsf_control.R" class="external-link"><code>R/orsf_control.R</code></a></small>
      <div class="d-none name"><code>orsf_control.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Oblique random forest control</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orsf_control</span><span class="op">(</span></span>
<span>  <span class="va">tree_type</span>,</span>
<span>  <span class="va">method</span>,</span>
<span>  <span class="va">scale_x</span>,</span>
<span>  <span class="va">ties</span>,</span>
<span>  <span class="va">net_mix</span>,</span>
<span>  <span class="va">target_df</span>,</span>
<span>  <span class="va">max_iter</span>,</span>
<span>  <span class="va">epsilon</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_control_classification</span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  scale_x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  net_mix <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  target_df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">1e-09</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_control_regression</span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  scale_x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  net_mix <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  target_df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">1e-09</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_control_survival</span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"glm"</span>,</span>
<span>  scale_x <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ties <span class="op">=</span> <span class="st">"efron"</span>,</span>
<span>  net_mix <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  target_df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  epsilon <span class="op">=</span> <span class="fl">1e-09</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>tree_type</dt>
<dd><p>(<em>character</em>) the type of tree. Valid options are</p><ul><li><p>"classification", i.e., categorical outcomes</p></li>
<li><p>"regression", i.e., continuous outcomes</p></li>
<li><p>"survival", i.e., time-to event outcomes</p></li>
</ul></dd>


<dt>method</dt>
<dd><p>(<em>character</em> or <em>function</em>) how to identify linear
linear combinations of predictors. If <code>method</code> is a character value,
it must be one of:</p><ul><li><p>'glm': linear, logistic, and cox regression</p></li>
<li><p>'net': same as 'glm' but with penalty terms</p></li>
<li><p>'pca': principal component analysis</p></li>
<li><p>'random': random draw from uniform distribution</p></li>
</ul><p>If <code>method</code> is a <em>function</em>, it will be used to identify  linear
combinations of predictor variables. <code>method</code> must in this case accept
three inputs named <code>x_node</code>, <code>y_node</code> and <code>w_node</code>, and should expect
the following types and dimensions:</p><ul><li><p><code>x_node</code> (<em>matrix</em>; <code>n</code> rows, <code>p</code> columns)</p></li>
<li><p><code>y_node</code> (<em>matrix</em>; <code>n</code> rows, <code>2</code> columns)</p></li>
<li><p><code>w_node</code> (<em>matrix</em>; <code>n</code> rows, <code>1</code> column)</p></li>
</ul><p>In addition, <code>method</code> must return a matrix with p rows and 1 column.</p></dd>


<dt>scale_x</dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, values of predictors will be
scaled prior to each instance of finding a linear combination of
predictors, using summary values from the data in the current node
of the decision tree.</p></dd>


<dt>ties</dt>
<dd><p>(<em>character</em>) a character string specifying the method
for tie handling. Only relevant when modeling survival outcomes
and using a method that engages with tied outcome times.
If there are no ties, all the methods are equivalent. Valid options
are 'breslow' and 'efron'. The Efron approximation is the default
because it is more accurate when dealing with tied event times and
has similar computational efficiency compared to the Breslow method.</p></dd>


<dt>net_mix</dt>
<dd><p>(<em>double</em>) The elastic net mixing parameter. A value of 1
gives the lasso penalty, and a value of 0 gives the ridge penalty. If
multiple values of alpha are given, then a penalized model is fit using
each alpha value prior to splitting a node.</p></dd>


<dt>target_df</dt>
<dd><p>(<em>integer</em>) Preferred number of variables used in each
linear combination. For example, with <code>mtry</code> of 5 and <code>target_df</code> of 3,
we sample 5 predictors and look for the best linear combination using
3 of them.</p></dd>


<dt>max_iter</dt>
<dd><p>(<em>integer</em>) iteration continues until convergence
(see <code>eps</code> above) or the number of attempted iterations is equal to
<code>iter_max</code>.</p></dd>


<dt>epsilon</dt>
<dd><p>(<em>double</em>) When using most modeling based method,
iteration continues in the algorithm until the relative change in
some kind of objective is less than <code>epsilon</code>, or the absolute
change is less than <code>sqrt(epsilon)</code>.</p></dd>


<dt>...</dt>
<dd><p>Further arguments passed to or from other methods (not currently used).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>an object of class <code>'orsf_control'</code>, which should be used as
an input for the <code>control</code> argument of <a href="orsf.html">orsf</a>. Components are:</p><ul><li><p><code>tree_type</code>: type of trees to fit</p></li>
<li><p><code>lincomb_type</code>: method for linear combinations</p></li>
<li><p><code>lincomb_eps</code>: epsilon for convergence</p></li>
<li><p><code>lincomb_iter_max</code>: max iterations</p></li>
<li><p><code>lincomb_scale</code>: to scale or not.</p></li>
<li><p><code>lincomb_alpha</code>: mixing parameter</p></li>
<li><p><code>lincomb_df_target</code>: target degrees of freedom</p></li>
<li><p><code>lincomb_ties_method</code>: method for ties in survival time</p></li>
<li><p><code>lincomb_R_function</code>: R function for custom splits</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Adjust <code>scale_x</code> <em>at your own risk</em>. Setting <code>scale_x = FALSE</code> will
reduce computation time but will also make the <code>orsf</code> model dependent
on the scale of your data, which is why the default value is <code>TRUE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>
    <p>First we load some relevant packages</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329730</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/aorsf" class="external-link">aorsf</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://imbs-hl.github.io/ranger/" class="external-link">ranger</a></span><span class="op">)</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tagteam/riskRegression" class="external-link">riskRegression</a></span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre><p></p></div><div class="section">
<h3 id="accelerated-linear-combinations">Accelerated linear combinations<a class="anchor" aria-label="anchor" href="#accelerated-linear-combinations"></a></h3>


<p>The accelerated ORSF ensemble is the default because it has a nice
balance of computational speed and prediction accuracy. It runs a single
iteration of Newton Raphson scoring on the Cox partial likelihood
function to find linear combinations of predictors.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit_accel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>, </span>
<span>                  control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control.html">orsf_control_survival</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                  formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                  tree_seeds <span class="op">=</span> <span class="fl">329</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="linear-combinations-with-cox-regression">Linear combinations with Cox regression<a class="anchor" aria-label="anchor" href="#linear-combinations-with-cox-regression"></a></h3>


<p>Setting inputs in <code>orsf_control_survival</code> to scale the X matrix and
repeat iterations until convergence allows you to run Cox regression in
each non-terminal node of each survival tree, using the regression
coefficients to create linear combinations of predictors:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">control_cph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_control.html">orsf_control_survival</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'glm'</span>, </span>
<span>                                     scale_x <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                                     max_iter <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_cph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>, </span>
<span>                control <span class="op">=</span> <span class="va">control_cph</span>,</span>
<span>                formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                tree_seeds <span class="op">=</span> <span class="fl">329</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="linear-combinations-with-penalized-cox-regression">Linear combinations with penalized cox regression<a class="anchor" aria-label="anchor" href="#linear-combinations-with-penalized-cox-regression"></a></h3>


<p>Setting <code>method == 'net'</code> runs penalized Cox regression in each
non-terminal node of each survival tree. This can be really helpful if
you want to do feature selection within the node, but it is a lot slower
than the <code>'glm'</code> option.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="co"># select 3 predictors out of 5 to be used in</span></span>
<span><span class="co"># each linear combination of predictors.</span></span>
<span></span>
<span><span class="va">control_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_control.html">orsf_control_survival</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">'net'</span>, target_df <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>, </span>
<span>                control <span class="op">=</span> <span class="va">control_net</span>,</span>
<span>                formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                tree_seeds <span class="op">=</span> <span class="fl">329</span><span class="op">)</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="linear-combinations-with-your-own-function">Linear combinations with your own function<a class="anchor" aria-label="anchor" href="#linear-combinations-with-your-own-function"></a></h3>


<p>In addition to the built-in methods, customized functions can be used to
identify linear combinations of predictors. We’ll demonstrate a few
here.</p><ul><li><p>The first uses random coefficients</p></li>
</ul><p></p><div class="sourceCode r"><pre><code><span><span class="va">f_rando</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x_node</span>, <span class="va">y_node</span>, <span class="va">w_node</span><span class="op">)</span><span class="op">{</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_node</span><span class="op">)</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span> </span>
<span><span class="op">}</span></span></code></pre><p></p></div><ul><li><p>The second derives coefficients from principal component analysis</p></li>
</ul><p></p><div class="sourceCode r"><pre><code><span><span class="va">f_pca</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x_node</span>, <span class="va">y_node</span>, <span class="va">w_node</span><span class="op">)</span> <span class="op">{</span> </span>
<span> </span>
<span> <span class="co"># estimate two principal components.</span></span>
<span> <span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">x_node</span>, rank. <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span> <span class="co"># use the second principal component to split the node</span></span>
<span> <span class="va">pca</span><span class="op">$</span><span class="va">rotation</span><span class="op">[</span>, <span class="fl">1L</span>, drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span> </span>
<span><span class="op">}</span></span></code></pre><p></p></div><ul><li><p>The third uses <code>ranger()</code> inside of <code><a href="orsf.html">orsf()</a></code>. This approach is very
similar to a method known as reinforcement learning trees (see the
<code>RLT</code> package), although our method of “muting” is very crude compared
to the method proposed by Zhu et al. </p></li>
</ul><p></p><div class="sourceCode r"><pre><code><span><span class="va">f_rlt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x_node</span>, <span class="va">y_node</span>, <span class="va">w_node</span><span class="op">)</span><span class="op">{</span></span>
<span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">y_node</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'time'</span>, <span class="st">'status'</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x_node</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_node</span><span class="op">)</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">''</span><span class="op">)</span></span>
<span> </span>
<span> <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">y_node</span>, <span class="va">x_node</span><span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span> <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">10</span><span class="op">)</span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">x_node</span><span class="op">)</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span> </span>
<span> <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">ranger</span><span class="fu">::</span><span class="fu"><a href="http://imbs-hl.github.io/ranger/reference/ranger.html" class="external-link">ranger</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, </span>
<span>                       formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span>, </span>
<span>                       num.trees <span class="op">=</span> <span class="fl">25</span>, </span>
<span>                       num.threads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                       min.node.size <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                       importance <span class="op">=</span> <span class="st">'permutation'</span><span class="op">)</span></span>
<span> </span>
<span> <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">variable.importance</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span> </span>
<span> <span class="co"># "mute" the least two important variables</span></span>
<span> <span class="va">n_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span> <span class="kw">if</span><span class="op">(</span><span class="va">n_vars</span> <span class="op">&gt;</span> <span class="fl">4</span><span class="op">)</span><span class="op">{</span></span>
<span>   <span class="va">out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">n_vars</span>, <span class="va">n_vars</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span> <span class="op">}</span></span>
<span> </span>
<span> <span class="co"># ensure out has same variable order as input</span></span>
<span> <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">x_node</span><span class="op">)</span><span class="op">]</span></span>
<span> </span>
<span> <span class="co"># protect yourself</span></span>
<span> <span class="va">out</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">out</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span> </span>
<span><span class="op">}</span></span></code></pre><p></p></div>
<p>We can plug these functions into <code><a href="orsf_control_custom.html">orsf_control_custom()</a></code>, and then pass
the result into <code><a href="orsf.html">orsf()</a></code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">fit_rando</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>,</span>
<span>                  <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                  control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control.html">orsf_control_survival</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">f_rando</span><span class="op">)</span>,</span>
<span>                  tree_seeds <span class="op">=</span> <span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>,</span>
<span>                <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control.html">orsf_control_survival</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">f_pca</span><span class="op">)</span>,</span>
<span>                tree_seeds <span class="op">=</span> <span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_rlt</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span><span class="va">pbc_orsf</span>, <span class="va">time</span> <span class="op">+</span> <span class="va">status</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>, </span>
<span>                control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control.html">orsf_control_survival</a></span><span class="op">(</span>method <span class="op">=</span> <span class="va">f_rlt</span><span class="op">)</span>,</span>
<span>                tree_seeds <span class="op">=</span> <span class="fl">329</span><span class="op">)</span></span></code></pre><p></p></div>
<p>So which fit seems to work best in this example? Let’s find out by
evaluating the out-of-bag survival predictions.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">risk_preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span> accel <span class="op">=</span> <span class="va">fit_accel</span><span class="op">$</span><span class="va">pred_oobag</span>,</span>
<span> cph   <span class="op">=</span> <span class="va">fit_cph</span><span class="op">$</span><span class="va">pred_oobag</span>,</span>
<span> net   <span class="op">=</span> <span class="va">fit_net</span><span class="op">$</span><span class="va">pred_oobag</span>,</span>
<span> rando <span class="op">=</span> <span class="va">fit_rando</span><span class="op">$</span><span class="va">pred_oobag</span>,</span>
<span> pca   <span class="op">=</span> <span class="va">fit_pca</span><span class="op">$</span><span class="va">pred_oobag</span>,</span>
<span> rlt   <span class="op">=</span> <span class="va">fit_rlt</span><span class="op">$</span><span class="va">pred_oobag</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/riskRegression/man/Score.html" class="external-link">Score</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">risk_preds</span>, </span>
<span>            formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="fl">1</span>, </span>
<span>            data <span class="op">=</span> <span class="va">pbc_orsf</span>, </span>
<span>            summary <span class="op">=</span> <span class="st">'IPA'</span>,</span>
<span>            times <span class="op">=</span> <span class="va">fit_accel</span><span class="op">$</span><span class="va">pred_horizon</span><span class="op">)</span></span></code></pre><p></p></div>
<p>The AUC values, from highest to lowest:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">sc</span><span class="op">$</span><span class="va">AUC</span><span class="op">$</span><span class="va">score</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">AUC</span><span class="op">)</span><span class="op">]</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##     model times       AUC         se     lower     upper</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##    &lt;fctr&gt; &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:    net  1788 0.9151649 0.02025057 0.8754745 0.9548553</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2:    rlt  1788 0.9119200 0.02090107 0.8709547 0.9528854</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3:  accel  1788 0.9095628 0.02143250 0.8675558 0.9515697</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4:    cph  1788 0.9095628 0.02143250 0.8675558 0.9515697</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 5:  rando  1788 0.9062197 0.02148854 0.8641029 0.9483365</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 6:    pca  1788 0.8983266 0.02303267 0.8531834 0.9434698</span></span></code></pre><p></p></div>
<p>And the indices of prediction accuracy:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">sc</span><span class="op">$</span><span class="va">Brier</span><span class="op">$</span><span class="va">score</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="op">-</span><span class="va">IPA</span><span class="op">)</span>, <span class="fu">.</span><span class="op">(</span><span class="va">model</span>, <span class="va">times</span>, <span class="va">IPA</span><span class="op">)</span><span class="op">]</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##         model times       IPA</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">##        &lt;fctr&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:        net  1788 0.4905777</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 2:      accel  1788 0.4806649</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 3:        cph  1788 0.4806649</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 4:        rlt  1788 0.4675228</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 5:        pca  1788 0.4369636</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 6:      rando  1788 0.4302814</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 7: Null model  1788 0.0000000</span></span></code></pre><p></p></div>
<p>From inspection,</p><ul><li><p><code>net</code>, <code>accel</code>, and <code>rlt</code> have high discrimination and index of
prediction accuracy.</p></li>
<li><p><code>rando</code> and <code>pca</code> do less well, but they aren’t bad.</p></li>
</ul></div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>linear combination control functions
<code><a href="orsf_control_cph.html">orsf_control_cph</a>()</code>,
<code><a href="orsf_control_custom.html">orsf_control_custom</a>()</code>,
<code><a href="orsf_control_fast.html">orsf_control_fast</a>()</code>,
<code><a href="orsf_control_net.html">orsf_control_net</a>()</code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Byron Jaeger.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

