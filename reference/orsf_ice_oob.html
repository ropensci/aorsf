<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Individual Conditional Expectations — orsf_ice_oob • aorsf</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Individual Conditional Expectations — orsf_ice_oob"><meta name="description" content="Compute individual conditional expectations for an
oblique random forest. Unlike partial dependence, which shows the expected prediction as a function of one or multiple predictors, individual conditional expectations (ICE) show the prediction for an individual observation as a function of a predictor.
You can compute individual conditional expectations three ways using a random forest:
using in-bag predictions for the training data
using out-of-bag predictions for the training data
using predictions for a new set of data


See examples for more details"><meta property="og:description" content="Compute individual conditional expectations for an
oblique random forest. Unlike partial dependence, which shows the expected prediction as a function of one or multiple predictors, individual conditional expectations (ICE) show the prediction for an individual observation as a function of a predictor.
You can compute individual conditional expectations three ways using a random forest:
using in-bag predictions for the training data
using out-of-bag predictions for the training data
using predictions for a new set of data


See examples for more details"><meta property="og:image" content="https://bcjaeger.github.io/aorsf/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aorsf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/aorsf.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/pd.html">PD and ICE curves with ORSF</a></li>
    <li><a class="dropdown-item" href="../articles/oobag.html">Out-of-bag predictions and evaluation</a></li>
    <li><a class="dropdown-item" href="../articles/fast.html">Tips to speed up computation</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/aorsf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Individual Conditional Expectations</h1>
      <small class="dont-index">Source: <a href="https://github.com/ropensci/aorsf/blob/main/R/orsf_pd.R" class="external-link"><code>R/orsf_pd.R</code></a></small>
      <div class="d-none name"><code>orsf_ice_oob.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute individual conditional expectations for an
oblique random forest. Unlike partial dependence, which shows the expected prediction as a function of one or multiple predictors, individual conditional expectations (ICE) show the prediction for an individual observation as a function of a predictor.
You can compute individual conditional expectations three ways using a random forest:</p><ul><li><p>using in-bag predictions for the training data</p></li>
<li><p>using out-of-bag predictions for the training data</p></li>
<li><p>using predictions for a new set of data</p></li>
</ul><p>See examples for more details</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">orsf_ice_oob</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">pred_spec</span>,</span>
<span>  pred_horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  expand_grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  boundary_checks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_thread <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_ice_inb</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">pred_spec</span>,</span>
<span>  pred_horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  expand_grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  boundary_checks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_thread <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">orsf_ice_new</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  <span class="va">pred_spec</span>,</span>
<span>  <span class="va">new_data</span>,</span>
<span>  pred_horizon <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  pred_type <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na_action <span class="op">=</span> <span class="st">"fail"</span>,</span>
<span>  expand_grid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  boundary_checks <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_thread <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose_progress <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>(<em>ObliqueForest</em>) a trained oblique random forest object (see <a href="orsf.html">orsf</a>).</p></dd>


<dt id="arg-pred-spec">pred_spec<a class="anchor" aria-label="anchor" href="#arg-pred-spec"></a></dt>
<dd><p>(<em>named list</em>, <em>pspec_auto</em>, or <em>data.frame</em>).</p><ul><li><p>If <code>pred_spec</code> is a named list,
Each item in the list should be a vector of values that will be used as
points in the partial dependence function. The name of each item in the
list should indicate which variable will be modified to take the
corresponding values.</p></li>
<li><p>If <code>pred_spec</code> is created using <code><a href="pred_spec_auto.html">pred_spec_auto()</a></code>, all that is needed
is the names of variables to use (see <a href="pred_spec_auto.html">pred_spec_auto</a>).</p></li>
<li><p>If <code>pred_spec</code> is a <code>data.frame</code>, columns will
indicate variable names, values will indicate variable values, and
partial dependence will be computed using the inputs on each row.</p></li>
</ul></dd>


<dt id="arg-pred-horizon">pred_horizon<a class="anchor" aria-label="anchor" href="#arg-pred-horizon"></a></dt>
<dd><p>(<em>double</em>) Only relevent for survival forests.
A value or vector indicating the time(s) that predictions will be
calibrated to. E.g., if you were predicting risk of incident heart
failure within the next 10 years, then <code>pred_horizon = 10</code>.
<code>pred_horizon</code> can be <code>NULL</code> if <code>pred_type</code> is <code>'mort'</code>, since
mortality predictions are aggregated over all event times</p></dd>


<dt id="arg-pred-type">pred_type<a class="anchor" aria-label="anchor" href="#arg-pred-type"></a></dt>
<dd><p>(<em>character</em>) the type of predictions to compute. Valid
Valid options for survival are:</p><ul><li><p>'risk' : probability of having an event at or before <code>pred_horizon</code>.</p></li>
<li><p>'surv' : 1 - risk.</p></li>
<li><p>'chf': cumulative hazard function</p></li>
<li><p>'mort': mortality prediction</p></li>
<li><p>'time': survival time prediction</p></li>
</ul><p>For classification:</p><ul><li><p>'prob': probability for each class</p></li>
</ul><p>For regression:</p><ul><li><p>'mean': predicted mean, i.e., the expected value</p></li>
</ul></dd>


<dt id="arg-expand-grid">expand_grid<a class="anchor" aria-label="anchor" href="#arg-expand-grid"></a></dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, partial dependence will be
computed at all possible combinations of inputs in <code>pred_spec</code>. If
<code>FALSE</code>, partial dependence will be computed for each variable
in <code>pred_spec</code>, separately.</p></dd>


<dt id="arg-boundary-checks">boundary_checks<a class="anchor" aria-label="anchor" href="#arg-boundary-checks"></a></dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, <code>pred_spec</code> will be checked
to make sure the requested values are between the 10th and 90th
percentile in the object's training data. If <code>FALSE</code>, these checks are
skipped.</p></dd>


<dt id="arg-n-thread">n_thread<a class="anchor" aria-label="anchor" href="#arg-n-thread"></a></dt>
<dd><p>(<em>integer</em>) number of threads to use while computing predictions. Default is 0, which allows a suitable number of threads to be used based on availability.</p></dd>


<dt id="arg-verbose-progress">verbose_progress<a class="anchor" aria-label="anchor" href="#arg-verbose-progress"></a></dt>
<dd><p>(<em>logical</em>) if <code>TRUE</code>, progress will be
printed to console. If <code>FALSE</code> (the default), nothing will be
printed.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Further arguments passed to or from other methods (not currently used).</p></dd>


<dt id="arg-new-data">new_data<a class="anchor" aria-label="anchor" href="#arg-new-data"></a></dt>
<dd><p>a <a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a>, <a href="https://tibble.tidyverse.org/reference/tibble-package.html" class="external-link">tibble</a>, or <a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a> to compute predictions in.</p></dd>


<dt id="arg-na-action">na_action<a class="anchor" aria-label="anchor" href="#arg-na-action"></a></dt>
<dd><p>(<em>character</em>) what should happen when <code>new_data</code> contains missing values (i.e., <code>NA</code> values). Valid options are:</p><ul><li><p>'fail' : an error is thrown if <code>new_data</code> contains <code>NA</code> values</p></li>
<li><p>'omit' : rows in <code>new_data</code> with incomplete data will be dropped</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a> containing
individual conditional expectations for the specified variable(s)
and, if relevant, at the specified prediction horizon(s).</p>
    </div>
    <div class="section level2">
    <h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h2>
    <p>You can compute individual conditional expectation and individual
conditional expectations in three ways:</p><ul><li><p>using in-bag predictions for the training data. In-bag individual
conditional expectation indicates relationships that the model has
learned during training. This is helpful if your goal is to interpret
the model.</p></li>
<li><p>using out-of-bag predictions for the training data. Out-of-bag
individual conditional expectation indicates relationships that the
model has learned during training but using the out-of-bag data
simulates application of the model to new data. This is helpful if you
want to test your model’s reliability or fairness in new data but you
don’t have access to a large testing set.</p></li>
<li><p>using predictions for a new set of data. New data individual
conditional expectation shows how the model predicts outcomes for
observations it has not seen. This is helpful if you want to test your
model’s reliability or fairness.</p></li>
</ul><div class="section">
<h3 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a></h3>


<p>Begin by fitting an oblique classification random forest:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins_orsf</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="va">penguins_orsf_train</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span><span class="va">penguins_orsf_test</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="op">-</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fit_clsf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins_orsf_train</span>,</span>
<span>                 formula <span class="op">=</span> <span class="va">species</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Compute individual conditional expectation using out-of-bag data for
<code>flipper_length_mm = c(190, 210)</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">190</span>, <span class="fl">210</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_oob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_oob</a></span><span class="op">(</span><span class="va">fit_clsf</span>, pred_spec <span class="op">=</span> <span class="va">pred_spec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_oob</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## Key: &lt;class&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##      id_variable id_row  class flipper_length_mm       pred</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##            &lt;int&gt; &lt;char&gt; &lt;fctr&gt;             &lt;num&gt;      &lt;num&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##   1:           1      1 Adelie               190 0.92059968</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##   2:           1      2 Adelie               190 0.80953569</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##   3:           1      3 Adelie               190 0.84869374</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##   4:           1      4 Adelie               190 0.93559660</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##   5:           1      5 Adelie               190 0.97708693</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">##  ---</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## 896:           2    146 Gentoo               210 0.25636964</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## 897:           2    147 Gentoo               210 0.04798334</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## 898:           2    148 Gentoo               210 0.07945140</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## 899:           2    149 Gentoo               210 0.84811899</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="do">## 900:           2    150 Gentoo               210 0.10695367</span></span></code></pre><p></p></div>
<p>There are two identifiers in the output:</p><ul><li><p><code>id_variable</code> is an identifier for the current value of the
variable(s) that are in the data. It is redundant if you only have one
variable, but helpful if there are multiple variables.</p></li>
<li><p><code>id_row</code> is an identifier for the observation in the original data.</p></li>
</ul><p>Note that predicted probabilities are returned for each class and each
observation in the data. Predicted probabilities for a given observation
and given variable value sum to 1. For example,</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">ice_oob</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span> <span class="va">.</span><span class="op">[</span><span class="va">flipper_length_mm</span> <span class="op">==</span> <span class="fl">190</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span> <span class="va">.</span><span class="op">[</span><span class="va">id_row</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span> <span class="va">.</span><span class="op">[[</span><span class="st">'pred'</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">## [1] 1</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="regression">Regression<a class="anchor" aria-label="anchor" href="#regression"></a></h3>


<p>Begin by fitting an oblique regression random forest:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins_orsf</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="va">penguins_orsf_train</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span><span class="va">penguins_orsf_test</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="op">-</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fit_regr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins_orsf_train</span>,</span>
<span>                 formula <span class="op">=</span> <span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Compute individual conditional expectation using new data for
<code>flipper_length_mm = c(190, 210)</code>.</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">190</span>, <span class="fl">210</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_new</a></span><span class="op">(</span><span class="va">fit_regr</span>,</span>
<span>                        pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                        new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##      id_variable id_row flipper_length_mm     pred</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##            &lt;int&gt; &lt;char&gt;             &lt;num&gt;    &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##   1:           1      1               190 37.94483</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##   2:           1      2               190 37.61595</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##   3:           1      3               190 37.53681</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##   4:           1      4               190 39.49476</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##   5:           1      5               190 38.95635</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##  ---</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 362:           2    179               210 51.80471</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## 363:           2    180               210 47.27183</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## 364:           2    181               210 47.05031</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## 365:           2    182               210 50.39028</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## 366:           2    183               210 48.44774</span></span></code></pre><p></p></div>
<p>You can also let <code>pred_spec_auto</code> pick reasonable values like so:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">pred_spec</span> <span class="op">=</span> <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">body_mass_g</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_new</a></span><span class="op">(</span><span class="va">fit_regr</span>,</span>
<span>                        pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                        new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##       id_variable id_row species    island body_mass_g     pred</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##             &lt;int&gt; &lt;char&gt;  &lt;fctr&gt;    &lt;fctr&gt;       &lt;num&gt;    &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##    1:           1      1  Adelie    Biscoe        3200 37.78339</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##    2:           1      2  Adelie    Biscoe        3200 37.73273</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##    3:           1      3  Adelie    Biscoe        3200 37.71248</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##    4:           1      4  Adelie    Biscoe        3200 40.25782</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##    5:           1      5  Adelie    Biscoe        3200 40.04074</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##   ---</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 8231:          45    179  Gentoo Torgersen        5300 46.14559</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## 8232:          45    180  Gentoo Torgersen        5300 43.98050</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## 8233:          45    181  Gentoo Torgersen        5300 44.59837</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## 8234:          45    182  Gentoo Torgersen        5300 44.85146</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## 8235:          45    183  Gentoo Torgersen        5300 44.23710</span></span></code></pre><p></p></div>
<p>By default, all combinations of all variables are used. However, you can
also look at the variables one by one, separately, like so:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">ice_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_new</a></span><span class="op">(</span><span class="va">fit_regr</span>,</span>
<span>                        expand_grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                        new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##       id_variable id_row    variable value  level     pred</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##             &lt;int&gt; &lt;char&gt;      &lt;char&gt; &lt;num&gt; &lt;char&gt;    &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##    1:           1      1     species    NA Adelie 37.74136</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##    2:           1      2     species    NA Adelie 37.42367</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##    3:           1      3     species    NA Adelie 37.04598</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##    4:           1      4     species    NA Adelie 39.89602</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##    5:           1      5     species    NA Adelie 39.14848</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##   ---</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 2009:           5    179 body_mass_g  5300   &lt;NA&gt; 51.50196</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## 2010:           5    180 body_mass_g  5300   &lt;NA&gt; 47.27055</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## 2011:           5    181 body_mass_g  5300   &lt;NA&gt; 48.34064</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## 2012:           5    182 body_mass_g  5300   &lt;NA&gt; 48.75828</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## 2013:           5    183 body_mass_g  5300   &lt;NA&gt; 48.11020</span></span></code></pre><p></p></div>
<p>And you can also bypass all the bells and whistles by using your own
<code>data.frame</code> for a <code>pred_spec</code>. (Just make sure you request values that
exist in the training data.)</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">custom_pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">'Adelie'</span>,</span>
<span>                               island <span class="op">=</span> <span class="st">'Biscoe'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_new</a></span><span class="op">(</span><span class="va">fit_regr</span>,</span>
<span>                        pred_spec <span class="op">=</span> <span class="va">custom_pred_spec</span>,</span>
<span>                        new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##      id_variable id_row species island     pred</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##            &lt;int&gt; &lt;char&gt;  &lt;fctr&gt; &lt;fctr&gt;    &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##   1:           1      1  Adelie Biscoe 38.52327</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##   2:           1      2  Adelie Biscoe 38.32073</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##   3:           1      3  Adelie Biscoe 37.71248</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##   4:           1      4  Adelie Biscoe 41.68380</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##   5:           1      5  Adelie Biscoe 40.91140</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##  ---</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 179:           1    179  Adelie Biscoe 43.09493</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## 180:           1    180  Adelie Biscoe 38.79455</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## 181:           1    181  Adelie Biscoe 39.37734</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## 182:           1    182  Adelie Biscoe 40.71952</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## 183:           1    183  Adelie Biscoe 39.34501</span></span></code></pre><p></p></div>
</div>

<div class="section">
<h3 id="survival">Survival<a class="anchor" aria-label="anchor" href="#survival"></a></h3>


<p>Begin by fitting an oblique survival random forest:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pbc_orsf</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pbc_orsf_train</span> <span class="op">&lt;-</span> <span class="va">pbc_orsf</span><span class="op">[</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span><span class="va">pbc_orsf_test</span> <span class="op">&lt;-</span> <span class="va">pbc_orsf</span><span class="op">[</span><span class="op">-</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fit_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pbc_orsf_train</span>,</span>
<span>                 formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                 oobag_pred_horizon <span class="op">=</span> <span class="fl">365.25</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span></code></pre><p></p></div>
<p>Compute individual conditional expectation using in-bag data for
<code>bili = c(1,2,3,4,5)</code>:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">ice_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, pred_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bili <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ice_train</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##      id_variable id_row pred_horizon  bili      pred</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##            &lt;int&gt; &lt;char&gt;        &lt;num&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##   1:           1      1      1826.25     1 0.1290317</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##   2:           1      2      1826.25     1 0.1242352</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##   3:           1      3      1826.25     1 0.0963452</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##   4:           1      4      1826.25     1 0.1172367</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##   5:           1      5      1826.25     1 0.2030256</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##  ---</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 746:           5    146      1826.25     5 0.7868537</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## 747:           5    147      1826.25     5 0.2012954</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## 748:           5    148      1826.25     5 0.4893605</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## 749:           5    149      1826.25     5 0.4698220</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## 750:           5    150      1826.25     5 0.9557285</span></span></code></pre><p></p></div>
<p>If you don’t have specific values of a variable in mind, let
<code>pred_spec_auto</code> pick for you:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">ice_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">bili</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ice_train</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##      id_variable id_row pred_horizon  bili       pred</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##            &lt;int&gt; &lt;char&gt;        &lt;num&gt; &lt;num&gt;      &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##   1:           1      1      1826.25  0.59 0.11706741</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##   2:           1      2      1826.25  0.59 0.11562173</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##   3:           1      3      1826.25  0.59 0.09110739</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##   4:           1      4      1826.25  0.59 0.10069721</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##   5:           1      5      1826.25  0.59 0.18769751</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##  ---</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 746:           5    146      1826.25  7.21 0.82600898</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## 747:           5    147      1826.25  7.21 0.29156437</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## 748:           5    148      1826.25  7.21 0.58220919</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## 749:           5    149      1826.25  7.21 0.54168688</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## 750:           5    150      1826.25  7.21 0.96204106</span></span></code></pre><p></p></div>
<p>Specify <code>pred_horizon</code> to get individual conditional expectation at each
value:</p>
<p></p><div class="sourceCode r"><pre><code><span><span class="va">ice_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">bili</span><span class="op">)</span>,</span>
<span>                          pred_horizon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">3000</span>, by <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ice_train</span></span></code></pre><p></p></div>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="do">##       id_variable id_row pred_horizon  bili        pred</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="do">##             &lt;int&gt; &lt;char&gt;        &lt;num&gt; &lt;num&gt;       &lt;num&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="do">##    1:           1      1          500  0.59 0.008276627</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="do">##    2:           1      1         1000  0.59 0.055715858</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="do">##    3:           1      1         1500  0.59 0.084987224</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="do">##    4:           1      1         2000  0.59 0.123090885</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="do">##    5:           1      1         2500  0.59 0.165214938</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="do">##   ---</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="do">## 4496:           5    150         1000  7.21 0.835895969</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="do">## 4497:           5    150         1500  7.21 0.932657591</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="do">## 4498:           5    150         2000  7.21 0.965944498</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="do">## 4499:           5    150         2500  7.21 0.970325309</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="do">## 4500:           5    150         3000  7.21 0.979051377</span></span></code></pre><p></p></div>
<p>Multi-prediction horizon ice comes with minimal extra computational
cost. Use a fine grid of time values and assess whether predictors have
time-varying effects.</p>
</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Byron Jaeger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

