<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Learn how to get started with the basics of aorsf.
">
<title>Introduction to aorsf • aorsf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to aorsf">
<meta property="og:description" content="Learn how to get started with the basics of aorsf.
">
<meta property="og:image" content="https://bcjaeger.github.io/aorsf/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">aorsf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/aorsf.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pd.html">Compute partial dependence with ORSF</a>
    <a class="dropdown-item" href="../articles/oobag.html">Out-of-bag predictions and evaluation</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bcjaeger/aorsf/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="aorsf_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to aorsf</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bcjaeger/aorsf/blob/HEAD/vignettes/aorsf.Rmd" class="external-link"><code>vignettes/aorsf.Rmd</code></a></small>
      <div class="d-none name"><code>aorsf.Rmd</code></div>
    </div>

    
    
<p>This article covers core features of the <code>aorsf</code> package. Separate articles will cover these features in more detail.</p>
<div class="section level2">
<h2 id="background-orsf">Background: ORSF<a class="anchor" aria-label="anchor" href="#background-orsf"></a>
</h2>
<p>The oblique random survival forest (ORSF) is an extension of the axis-based RSF algorithm that can be found in several R packages, including <code>RandomForestSRC</code>, <code>party</code>, and <code>ranger</code>.</p>
</div>
<div class="section level2">
<h2 id="what-is-an-oblique-decision-tree">What is an oblique decision tree?<a class="anchor" aria-label="anchor" href="#what-is-an-oblique-decision-tree"></a>
</h2>
<p>Decision trees are developed by splitting a set of training data into two new subsets, with the goal of having more similarity within the new subsets than between them. This splitting process is repeated on the resulting subsets of data until a stopping criterion is met. When the new subsets of data are formed based on a single predictor, the decision tree is said to be axis-based because the splits of the data appear perpendicular to the axis of the predictor. When linear combinations of variables are used instead of a single variable, the tree is oblique because the splits of the data are neither parallel nor at a right angle to the axis.</p>
<div class="figure">
<img src="tree_axis_v_oblique.png" alt="Decision trees for classification with axis-based splitting (left) and oblique splitting (right). Cases are orange squares; controls are purple circles. Both trees partition the predictor space defined by variables X1 and X2, but the oblique splits do a better job of separating the two classes." width="100%"><p class="caption">
Decision trees for classification with axis-based splitting (left) and oblique splitting (right). Cases are orange squares; controls are purple circles. Both trees partition the predictor space defined by variables X1 and X2, but the oblique splits do a better job of separating the two classes.
</p>
</div>
</div>
<div class="section level2">
<h2 id="accelerated-orsf">Accelerated ORSF<a class="anchor" aria-label="anchor" href="#accelerated-orsf"></a>
</h2>
<p>The purpose of <code>aorsf</code> (‘a’ is short for accelerated) is to provide routines to fit ORSFs that will scale adequately to large data sets. For example, <code><a href="../reference/orsf.html">aorsf::orsf()</a></code> runs about 500 times faster than its predecessor, <code>obliqueRSF::ORSF()</code>.</p>
<p>To fit an accelerated ORSF model, use the <code>orsf</code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bcjaeger/aorsf" class="external-link">aorsf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">orsf_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pbc_orsf</span>, </span>
<span>                 formula <span class="op">=</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>, </span>
<span>                 n_tree <span class="op">=</span> <span class="fl">2500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">orsf_fit</span></span>
<span><span class="co">#&gt; ---------- Oblique random survival forest</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           N observations: 276</span></span>
<span><span class="co">#&gt;                 N events: 111</span></span>
<span><span class="co">#&gt;                  N trees: 2500</span></span>
<span><span class="co">#&gt;       N predictors total: 17</span></span>
<span><span class="co">#&gt;    N predictors per node: 5</span></span>
<span><span class="co">#&gt;  Average leaves per tree: 24</span></span>
<span><span class="co">#&gt; Min observations in leaf: 5</span></span>
<span><span class="co">#&gt;       Min events in leaf: 1</span></span>
<span><span class="co">#&gt;           OOB stat value: 0.84</span></span>
<span><span class="co">#&gt;            OOB stat type: Harrell's C-statistic</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>you may notice that the first input of <code>aorsf</code> is <code>data</code>. This is a design choice that makes it easier to use <code>orsf</code> with pipes (i.e., <code>%&gt;%</code> or <code>|&gt;</code>). For instance,</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">orsf_fit</span> <span class="op">&lt;-</span> <span class="va">pbc_orsf</span> <span class="op">|&gt;</span> </span>
<span> <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">id</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="fu">Surv</span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>In addition to their reputation for slow computing, oblique decision trees are considered less interpretable than their axis-based counterparts. The opinionated developer of <code>aorsf</code> disagrees with this sentiment, and has included routines in <code>aorsf</code> that use coefficients from linear combinations of input variables to estimate variable importance and identify pair-wise interactions.</p>
<div class="section level3">
<h3 id="variable-importance">Variable importance<a class="anchor" aria-label="anchor" href="#variable-importance"></a>
</h3>
<p><code>aorsf</code> provides multiple ways to compute variable importance.</p>
<ul>
<li>To compute negation importance, ORSF multiplies each coefficient of that variable by -1 and then re-computes the out-of-sample (sometimes referred to as out-of-bag) accuracy of the ORSF model.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">variable_importance</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_vi_negate.html">orsf_vi_negate</a></span><span class="op">(</span><span class="va">orsf_fit</span><span class="op">)</span></span>
<span></span>
<span><span class="va">variable_importance</span></span>
<span><span class="co">#&gt;          bili           age       ascites       protime        copper </span></span>
<span><span class="co">#&gt;  0.0134923942  0.0085434466  0.0057824547  0.0046363826  0.0037507814 </span></span>
<span><span class="co">#&gt;       spiders         edema         stage           sex           ast </span></span>
<span><span class="co">#&gt;  0.0036465930  0.0028751029  0.0022921442  0.0016670140  0.0012502605 </span></span>
<span><span class="co">#&gt;        hepato      alk.phos          chol          trig           trt </span></span>
<span><span class="co">#&gt; -0.0003125651 -0.0012502605 -0.0017191081 -0.0018232965 -0.0026568035 </span></span>
<span><span class="co">#&gt;      platelet </span></span>
<span><span class="co">#&gt; -0.0028130861</span></span></code></pre></div>
<!-- ### Variable interaction -->
<!-- ORSF's two-way interaction score for a pair of predictors is the proportion of variability in the coefficient of one predictor explained by the mean of the other. If one predictor's coefficient is highly correlated with another predictor's mean value, the two-way interaction score will be high (maximum value of the score is 1). If there is no correlation between the coefficient of one predictor and the mean value of another, the two-way interaction score will be low (minimum value of the score is 0). -->
<!-- ```{r} -->
<!-- variable_interaction <- orsf_interaction(orsf_fit) -->
<!-- variable_interaction[1:5, ] -->
<!-- ``` -->
</div>
<div class="section level3">
<h3 id="partial-dependence">Partial dependence<a class="anchor" aria-label="anchor" href="#partial-dependence"></a>
</h3>
<p><code>edema == 1</code> may modify the effect of <code>bili</code>. We can use the <code><a href="../reference/orsf_pd_summary.html">orsf_pd_summary()</a></code> function (pd = partial dependence) to explore how these variables influence the expected prediction from ORSF. Below, we look at partial dependence at a prediction horizon of 5 years.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># make a list containing the variable values you</span></span>
<span><span class="co"># want to compute partial dependence for</span></span>
<span><span class="va">pd_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>edema <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"0.5"</span>, <span class="st">"1"</span><span class="op">)</span>,</span>
<span>                bili <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">7.1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># orsf_pd_summary automatically computes pd for all combinations</span></span>
<span><span class="co"># in the list (this can be turned off with expand_grid = FALSE)</span></span>
<span><span class="va">pd_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_summary.html">orsf_pd_summary</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">orsf_fit</span>, </span>
<span>                           pd_spec <span class="op">=</span> <span class="va">pd_spec</span>,</span>
<span>                           expand_grid <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                           pred_horizon <span class="op">=</span> <span class="fl">365.25</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pd_data</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bili</span>, y <span class="op">=</span> <span class="va">mean</span>, col <span class="op">=</span> <span class="va">edema</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">'Predicted risk'</span>,</span>
<span>      x <span class="op">=</span> <span class="st">'Bilirubin'</span>,</span>
<span>      title <span class="op">=</span> <span class="st">'Partial dependence of bilirubin and edema'</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="aorsf_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>The presence of edema clearly impacts predicted risk, which makes it hard to see the interaction effect in this plot. Let’s align the partial dependence values for the edema subgroups so that each curve will start at a value of 0</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># aligning predictions at lowest value of bili</span></span>
<span><span class="va">min_ed_0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pd_data</span>, <span class="va">mean</span><span class="op">[</span><span class="va">edema</span> <span class="op">==</span> <span class="st">"0"</span>   <span class="op">&amp;</span> <span class="va">bili</span> <span class="op">==</span> <span class="fl">0.6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">min_ed_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pd_data</span>, <span class="va">mean</span><span class="op">[</span><span class="va">edema</span> <span class="op">==</span> <span class="st">"0.5"</span> <span class="op">&amp;</span> <span class="va">bili</span> <span class="op">==</span> <span class="fl">0.6</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">min_ed_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pd_data</span>, <span class="va">mean</span><span class="op">[</span><span class="va">edema</span> <span class="op">==</span> <span class="st">"1"</span>   <span class="op">&amp;</span> <span class="va">bili</span> <span class="op">==</span> <span class="fl">0.6</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_data_aligned</span> <span class="op">&lt;-</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">pd_data</span>, <span class="op">{</span></span>
<span>  <span class="va">value</span> <span class="op">&lt;-</span> <span class="va">mean</span></span>
<span>  <span class="va">value</span><span class="op">[</span><span class="va">edema</span> <span class="op">==</span> <span class="st">"0"</span> <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">value</span><span class="op">[</span><span class="va">edema</span> <span class="op">==</span> <span class="st">"0"</span> <span class="op">]</span> <span class="op">-</span> <span class="va">min_ed_0</span></span>
<span>  <span class="va">value</span><span class="op">[</span><span class="va">edema</span> <span class="op">==</span> <span class="st">"0.5"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">value</span><span class="op">[</span><span class="va">edema</span> <span class="op">==</span> <span class="st">"0.5"</span><span class="op">]</span> <span class="op">-</span> <span class="va">min_ed_1</span></span>
<span>  <span class="va">value</span><span class="op">[</span><span class="va">edema</span> <span class="op">==</span> <span class="st">"1"</span> <span class="op">]</span> <span class="op">&lt;-</span> <span class="va">value</span><span class="op">[</span><span class="va">edema</span> <span class="op">==</span> <span class="st">"1"</span> <span class="op">]</span> <span class="op">-</span> <span class="va">min_ed_2</span></span>
<span> <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pd_data_aligned</span><span class="op">)</span></span>
<span><span class="co">#&gt;    edema bili      mean        lwr      medn       upr       value</span></span>
<span><span class="co">#&gt; 1:     0  0.6 0.2149491 0.01080575 0.1137336 0.7657705 0.000000000</span></span>
<span><span class="co">#&gt; 2:   0.5  0.6 0.2741353 0.03608109 0.1817965 0.7841916 0.000000000</span></span>
<span><span class="co">#&gt; 3:     1  0.6 0.3871624 0.16876186 0.3089575 0.8766335 0.000000000</span></span>
<span><span class="co">#&gt; 4:     0  0.7 0.2164976 0.01087216 0.1138735 0.7712087 0.001548474</span></span>
<span><span class="co">#&gt; 5:   0.5  0.7 0.2762397 0.03626453 0.1829204 0.7878749 0.002104399</span></span>
<span><span class="co">#&gt; 6:     1  0.7 0.3886400 0.16936039 0.3116935 0.8779078 0.001477504</span></span></code></pre></div>
<p>With the aligned partial dependence values we can see the interaction effect clearly. Increasing bilirubin solicits a greater increase in predicted risk for patients with no edema (<code>edema == 0</code>), untreated edema (<code>edema == 0.5</code>), or successfully treated edema (<code>edema == 0.5</code>) compared to patients with therapy-resistant edema (<code>edema == 1</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pd_data_aligned</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bili</span>, y <span class="op">=</span> <span class="va">value</span>, col <span class="op">=</span> <span class="va">edema</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">'Predictions centered at Bilirubin = 0.6'</span>,</span>
<span>      x <span class="op">=</span> <span class="st">'Bilirubin'</span>,</span>
<span>      title <span class="op">=</span> <span class="st">'Interaction between bilirubin and edema'</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="aorsf_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>The similarity in trajectories for patients with <code>edema == 0</code> and <code>edema == 0.5</code> suggests that <code>edema == 1</code> has the strongest modifying effect of bilirubin. As a sanity check, we can fit a Cox regression model and conduct a likelihood ratio test for this interaction:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">edema</span> <span class="op">*</span> <span class="va">bili</span>, data <span class="op">=</span> <span class="va">pbc_orsf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Deviance Table</span></span>
<span><span class="co">#&gt;  Cox model: response is Surv(time, status)</span></span>
<span><span class="co">#&gt; Terms added sequentially (first to last)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;             loglik   Chisq Df Pr(&gt;|Chi|)    </span></span>
<span><span class="co">#&gt; NULL       -550.19                          </span></span>
<span><span class="co">#&gt; edema      -524.61 51.1681  2  7.744e-12 ***</span></span>
<span><span class="co">#&gt; bili       -502.51 44.1953  1  2.972e-11 ***</span></span>
<span><span class="co">#&gt; edema:bili -498.64  7.7459  2     0.0208 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>The interaction p-value of 0.0208 above should not be interpreted in the usual way because it was not an apriori hypothesis, (I used other software to score every pairwise interaction in the data and picked one with a strong score). However, it is nice to see that an interaction identified by ORSF’s partial dependence function is also identified with a traditional modeling strategy.</p>
</div>
<div class="section level3">
<h3 id="summarize-orsf-models">Summarize ORSF models<a class="anchor" aria-label="anchor" href="#summarize-orsf-models"></a>
</h3>
<p>Getting straight to variable importance and partial dependence in a direct way can often be helpful in exploratory analyses. When you want a lot of information for just a little code, <code><a href="../reference/orsf_summarize_uni.html">orsf_summarize_uni()</a></code> is the tool for you:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/orsf_summarize_uni.html">orsf_summarize_uni</a></span><span class="op">(</span><span class="va">orsf_fit</span>, </span>
<span>                   n_variables <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                   pred_horizon <span class="op">=</span> <span class="fl">365.25</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- bili (VI Rank: 1) ---------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        |---------------- risk ----------------|</span></span>
<span><span class="co">#&gt;  Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;   0.80 0.2321709 0.1250703 0.04511286 0.3822285</span></span>
<span><span class="co">#&gt;   1.40 0.2526454 0.1452361 0.05893072 0.4017982</span></span>
<span><span class="co">#&gt;   3.52 0.3716990 0.2879513 0.16520375 0.5483311</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- age (VI Rank: 2) ----------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        |---------------- risk ----------------|</span></span>
<span><span class="co">#&gt;  Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;   41.5 0.2738421 0.1429054 0.04190491 0.4670137</span></span>
<span><span class="co">#&gt;   49.7 0.3012377 0.1711906 0.04922133 0.5312928</span></span>
<span><span class="co">#&gt;   56.6 0.3324703 0.2206562 0.07135028 0.5659502</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- ascites (VI Rank: 3) ------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        |---------------- risk ----------------|</span></span>
<span><span class="co">#&gt;  Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;      0 0.2962853 0.1559449 0.04856002 0.5312403</span></span>
<span><span class="co">#&gt;      1 0.4707099 0.3853747 0.27346654 0.6542754</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- protime (VI Rank: 4) ------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        |---------------- risk ----------------|</span></span>
<span><span class="co">#&gt;  Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;   10.0 0.2836244 0.1532223 0.04709130 0.5059426</span></span>
<span><span class="co">#&gt;   10.6 0.2956075 0.1611090 0.05140038 0.5249728</span></span>
<span><span class="co">#&gt;   11.2 0.3168198 0.1890442 0.06756468 0.5346692</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- copper (VI Rank: 5) -------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;        |---------------- risk ----------------|</span></span>
<span><span class="co">#&gt;  Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;   42.8 0.2656012 0.1388691 0.04530208 0.4752255</span></span>
<span><span class="co">#&gt;   74.0 0.2823505 0.1590903 0.05506762 0.5037839</span></span>
<span><span class="co">#&gt;    129 0.3358382 0.2179729 0.10527331 0.5494800</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Predicted risk at time t = 1826.25 for top 5 predictors</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="what-about-the-original-orsf">What about the original ORSF?<a class="anchor" aria-label="anchor" href="#what-about-the-original-orsf"></a>
</h2>
<p>The original ORSF (i.e., <code>obliqueRSF</code>) used <code>glmnet</code> to find linear combinations of inputs. <code>aorsf</code> allows users to implement this approach using the <code><a href="../reference/orsf_control_net.html">orsf_control_net()</a></code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">orsf_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pbc_orsf</span>, </span>
<span>                 formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>, </span>
<span>                 control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control_net.html">orsf_control_net</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 n_tree <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span></code></pre></div>
<p><code>net</code> forests fit a lot faster than the original ORSF function in <code>obliqueRSF</code>. However, <code>net</code> forests are still much slower than <code>cph</code> ones:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># tracking how long it takes to fit 50 glmnet trees</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span> <span class="va">t1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pbc_orsf</span>, </span>
<span>       formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>, </span>
<span>       control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control_net.html">orsf_control_net</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>       n_tree <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span> <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   4.681   0.000   4.682</span></span>
<span></span>
<span><span class="co"># and how long it takes to fit 50 cph trees</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span></span>
<span> <span class="va">t2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pbc_orsf</span>, </span>
<span>       formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>, </span>
<span>       control <span class="op">=</span> <span class="fu"><a href="../reference/orsf_control_cph.html">orsf_control_cph</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>       n_tree <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span> <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;    user  system elapsed </span></span>
<span><span class="co">#&gt;   0.034   0.000   0.033</span></span>
<span></span>
<span><span class="va">t1</span><span class="op">[</span><span class="st">'elapsed'</span><span class="op">]</span> <span class="op">/</span> <span class="va">t2</span><span class="op">[</span><span class="st">'elapsed'</span><span class="op">]</span></span>
<span><span class="co">#&gt;  elapsed </span></span>
<span><span class="co">#&gt; 141.8788</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="aorsf-and-other-machine-learning-software">aorsf and other machine learning software<a class="anchor" aria-label="anchor" href="#aorsf-and-other-machine-learning-software"></a>
</h2>
<p>Generally, <code>aorsf</code> follows conventions set by the R packages <code>randomForest</code> and <code>randomForestSRC</code>. For example, the <code>print</code> method for <code>aorsf</code> models is very similar to <code>randomForestSRC</code> models, as is the specification of computing variable importance and the objects returned by variable importance functions. Similar to <code>randomForestSRC</code>, <code>aorsf</code> allows and recommends partial dependence to be estimated using out-of-bag data.</p>
<p>The unique feature of <code>aorsf</code> is fitting oblique random survival forests fast while maintaining strong prediction accuracy. <code>RLT</code> and <code>obliqueRSF</code> both fit oblique random survival forests, but <code>aorsf</code> does so faster. <code>ranger</code> and <code>randomForestSRC</code> fit survival forests, but neither package supports oblique splitting. <code>obliqueRF</code> fits oblique random forests for classification and regression, but not survival. <code>PPforest</code> fits oblique random forests for classification but not survival. The default prediction behavior for <code>aorsf</code> models is to produce predicted risk at a specific prediction horizon, which is not the default for <code>ranger</code> or <code>randomForestSRC</code>.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Byron Jaeger.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
