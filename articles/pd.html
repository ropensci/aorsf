<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>PD and ICE curves with ORSF • aorsf</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="PD and ICE curves with ORSF">
<meta name="description" content="Learn how to interpret ORSF models using partial dependence.
">
<meta property="og:description" content="Learn how to interpret ORSF models using partial dependence.
">
<meta property="og:image" content="https://bcjaeger.github.io/aorsf/logo.png">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">aorsf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/aorsf.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/pd.html">PD and ICE curves with ORSF</a></li>
    <li><a class="dropdown-item" href="../articles/oobag.html">Out-of-bag predictions and evaluation</a></li>
    <li><a class="dropdown-item" href="../articles/fast.html">Tips to speed up computation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci/aorsf/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>PD and ICE curves with ORSF</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/aorsf/blob/main/vignettes/pd.Rmd" class="external-link"><code>vignettes/pd.Rmd</code></a></small>
      <div class="d-none name"><code>pd.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="partial-dependence-pd">Partial dependence (PD)<a class="anchor" aria-label="anchor" href="#partial-dependence-pd"></a>
</h2>
<p>Partial dependence (PD) shows the expected prediction from a model as
a function of a single predictor or multiple predictors. The expectation
is marginalized over the values of all other predictors, giving
something like a multivariable adjusted estimate of the model’s
prediction.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/aorsf" class="external-link">aorsf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>You can compute PD and individual conditional expectation (ICE) in
three ways:</p>
<ul>
<li><p>using in-bag predictions for the training data. In-bag PD
indicates relationships that the model has learned during training. This
is helpful if your goal is to interpret the model.</p></li>
<li><p>using out-of-bag predictions for the training data. Out-of-bag PD
indicates relationships that the model has learned during training but
using the out-of-bag data simulates application of the model to new
data. This is helpful if you want to test your model’s reliability or
fairness in new data but you don’t have access to a large testing
set.</p></li>
<li><p>using predictions for a new set of data. New data PD shows how
the model predicts outcomes for observations it has not seen. This is
helpful if you want to test your model’s reliability or
fairness.</p></li>
</ul>
<div class="section level3">
<h3 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a>
</h3>
<p>Begin by fitting an oblique classification random forest:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins_orsf</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">penguins_orsf_train</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span><span class="va">penguins_orsf_test</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="op">-</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fit_clsf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins_orsf_train</span>, </span>
<span>                 formula <span class="op">=</span> <span class="va">species</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>Compute PD using out-of-bag data for
<code>flipper_length_mm = c(190, 210)</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">190</span>, <span class="fl">210</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_oob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_oob</a></span><span class="op">(</span><span class="va">fit_clsf</span>, pred_spec <span class="op">=</span> <span class="va">pred_spec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_oob</span></span>
<span><span class="co">#&gt; Key: &lt;class&gt;</span></span>
<span><span class="co">#&gt;        class flipper_length_mm      mean         lwr       medn       upr</span></span>
<span><span class="co">#&gt;       &lt;fctr&gt;             &lt;num&gt;     &lt;num&gt;       &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:    Adelie               190 0.6189516 0.203758520 0.76151989 0.9804701</span></span>
<span><span class="co">#&gt; 2:    Adelie               210 0.4345264 0.019621063 0.57083317 0.8670605</span></span>
<span><span class="co">#&gt; 3: Chinstrap               190 0.2117026 0.017689034 0.15427910 0.7211906</span></span>
<span><span class="co">#&gt; 4: Chinstrap               210 0.1827278 0.019156532 0.09488838 0.7040271</span></span>
<span><span class="co">#&gt; 5:    Gentoo               190 0.1693458 0.001386842 0.02817413 0.5722259</span></span>
<span><span class="co">#&gt; 6:    Gentoo               210 0.3827458 0.064744748 0.20052813 0.9478840</span></span></code></pre></div>
<p>Note that predicted probabilities are returned for each class and
probabilities in the <code>mean</code> column sum to 1 if you take the
sum over each class at a specific value of the <code>pred_spec</code>
variables. For example,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pd_oob</span><span class="op">[</span><span class="va">flipper_length_mm</span> <span class="op">==</span> <span class="fl">190</span>, <span class="va">mean</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<p>But this isn’t the case for the median predicted probability!</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pd_oob</span><span class="op">[</span><span class="va">flipper_length_mm</span> <span class="op">==</span> <span class="fl">190</span>, <span class="va">medn</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9439731</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="regression">Regression<a class="anchor" aria-label="anchor" href="#regression"></a>
</h3>
<p>Begin by fitting an oblique regression random forest:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">penguins_orsf</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">penguins_orsf_train</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span><span class="va">penguins_orsf_test</span> <span class="op">&lt;-</span> <span class="va">penguins_orsf</span><span class="op">[</span><span class="op">-</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fit_regr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins_orsf_train</span>, </span>
<span>                 formula <span class="op">=</span> <span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<p>Compute PD using new data for
<code>flipper_length_mm = c(190, 210)</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">190</span>, <span class="fl">210</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                      pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                      new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span></span>
<span><span class="co">#&gt;    flipper_length_mm     mean      lwr     medn      upr</span></span>
<span><span class="co">#&gt;                &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:               190 42.98432 37.09469 43.70910 48.68249</span></span>
<span><span class="co">#&gt; 2:               210 45.67197 40.51672 46.32944 51.70136</span></span></code></pre></div>
<p>You can also let <code>pred_spec_auto</code> pick reasonable values
like so:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pred_spec</span> <span class="op">=</span> <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">body_mass_g</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                      pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                      new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span></span>
<span><span class="co">#&gt;       species    island body_mass_g     mean      lwr     medn      upr</span></span>
<span><span class="co">#&gt;        &lt;fctr&gt;    &lt;fctr&gt;       &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:    Adelie    Biscoe        3200 40.33738 37.22209 40.35623 44.24697</span></span>
<span><span class="co">#&gt;  2: Chinstrap    Biscoe        3200 45.15968 42.65776 45.17753 47.66077</span></span>
<span><span class="co">#&gt;  3:    Gentoo    Biscoe        3200 42.85356 40.20251 42.58572 46.90547</span></span>
<span><span class="co">#&gt;  4:    Adelie     Dream        3200 40.18136 36.99455 40.38046 43.93391</span></span>
<span><span class="co">#&gt;  5: Chinstrap     Dream        3200 46.25073 43.56337 45.95777 49.20569</span></span>
<span><span class="co">#&gt;  6:    Gentoo     Dream        3200 42.64433 39.89356 42.65380 46.35684</span></span>
<span><span class="co">#&gt;  7:    Adelie Torgersen        3200 39.91590 36.77811 39.78430 43.70360</span></span>
<span><span class="co">#&gt;  8: Chinstrap Torgersen        3200 44.32424 41.97782 44.44428 46.74401</span></span>
<span><span class="co">#&gt;  9:    Gentoo Torgersen        3200 42.13079 39.48500 41.81257 45.88565</span></span>
<span><span class="co">#&gt; 10:    Adelie    Biscoe        3550 40.82883 38.05637 40.61602 44.62936</span></span>
<span><span class="co">#&gt; 11: Chinstrap    Biscoe        3550 45.85867 43.52230 45.78296 48.38591</span></span>
<span><span class="co">#&gt; 12:    Gentoo    Biscoe        3550 43.37087 40.80462 43.02377 47.30973</span></span>
<span><span class="co">#&gt; 13:    Adelie     Dream        3550 40.82540 38.14951 40.78235 44.42058</span></span>
<span><span class="co">#&gt; 14: Chinstrap     Dream        3550 47.33983 44.86173 46.80613 50.46394</span></span>
<span><span class="co">#&gt; 15:    Gentoo     Dream        3550 43.32028 40.87838 43.22933 46.97065</span></span>
<span><span class="co">#&gt; 16:    Adelie Torgersen        3550 40.26443 37.35373 40.07674 44.07842</span></span>
<span><span class="co">#&gt; 17: Chinstrap Torgersen        3550 44.82874 42.65262 44.91015 47.20427</span></span>
<span><span class="co">#&gt; 18:    Gentoo Torgersen        3550 42.53331 40.00016 42.11004 46.34434</span></span>
<span><span class="co">#&gt; 19:    Adelie    Biscoe        3975 41.65217 38.95582 41.37085 45.42322</span></span>
<span><span class="co">#&gt; 20: Chinstrap    Biscoe        3975 46.61912 44.60091 46.48993 49.10143</span></span>
<span><span class="co">#&gt; 21:    Gentoo    Biscoe        3975 44.10667 41.58521 43.75246 47.92287</span></span>
<span><span class="co">#&gt; 22:    Adelie     Dream        3975 41.55214 39.17218 41.22423 45.18560</span></span>
<span><span class="co">#&gt; 23: Chinstrap     Dream        3975 48.17340 45.91190 47.60164 51.49108</span></span>
<span><span class="co">#&gt; 24:    Gentoo     Dream        3975 44.05948 41.76161 43.85747 47.58576</span></span>
<span><span class="co">#&gt; 25:    Adelie Torgersen        3975 40.96341 38.12704 40.69760 44.71637</span></span>
<span><span class="co">#&gt; 26: Chinstrap Torgersen        3975 45.47718 43.49451 45.49126 47.68031</span></span>
<span><span class="co">#&gt; 27:    Gentoo Torgersen        3975 43.15559 40.71655 42.64245 46.92422</span></span>
<span><span class="co">#&gt; 28:    Adelie    Biscoe        4700 42.91185 40.44139 42.40096 46.78877</span></span>
<span><span class="co">#&gt; 29: Chinstrap    Biscoe        4700 47.19084 45.41620 47.09687 49.55237</span></span>
<span><span class="co">#&gt; 30:    Gentoo    Biscoe        4700 45.31486 43.07576 44.86043 49.23657</span></span>
<span><span class="co">#&gt; 31:    Adelie     Dream        4700 42.75827 40.50770 42.15596 46.52367</span></span>
<span><span class="co">#&gt; 32: Chinstrap     Dream        4700 48.39701 46.33896 48.04037 51.17168</span></span>
<span><span class="co">#&gt; 33:    Gentoo     Dream        4700 45.11246 42.93144 44.78240 48.81725</span></span>
<span><span class="co">#&gt; 34:    Adelie Torgersen        4700 42.10446 39.73620 41.57600 45.70392</span></span>
<span><span class="co">#&gt; 35: Chinstrap Torgersen        4700 46.20346 44.46117 46.16889 48.37807</span></span>
<span><span class="co">#&gt; 36:    Gentoo Torgersen        4700 44.33649 42.23955 43.82640 48.03150</span></span>
<span><span class="co">#&gt; 37:    Adelie    Biscoe        5300 43.85931 41.38190 43.20628 48.06228</span></span>
<span><span class="co">#&gt; 38: Chinstrap    Biscoe        5300 47.56544 45.69049 47.53388 49.86297</span></span>
<span><span class="co">#&gt; 39:    Gentoo    Biscoe        5300 46.16857 43.81217 45.58655 50.60107</span></span>
<span><span class="co">#&gt; 40:    Adelie     Dream        5300 43.61141 41.29873 43.19309 47.47156</span></span>
<span><span class="co">#&gt; 41: Chinstrap     Dream        5300 48.51039 46.39622 48.29055 51.00490</span></span>
<span><span class="co">#&gt; 42:    Gentoo     Dream        5300 45.93975 43.71594 45.53941 49.90436</span></span>
<span><span class="co">#&gt; 43:    Adelie Torgersen        5300 42.93254 40.64232 42.32693 46.81252</span></span>
<span><span class="co">#&gt; 44: Chinstrap Torgersen        5300 46.65325 44.85232 46.56831 49.08427</span></span>
<span><span class="co">#&gt; 45:    Gentoo Torgersen        5300 45.12114 42.96226 44.52876 49.34430</span></span>
<span><span class="co">#&gt;       species    island body_mass_g     mean      lwr     medn      upr</span></span></code></pre></div>
<p>By default, all combinations of all variables are used. However, you
can also look at the variables one by one, separately, like so:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pd_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                      expand_grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                      pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                      new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span></span>
<span><span class="co">#&gt;        variable value     level     mean      lwr     medn      upr</span></span>
<span><span class="co">#&gt;          &lt;char&gt; &lt;num&gt;    &lt;char&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:     species    NA    Adelie 41.89587 37.10910 41.50096 48.43226</span></span>
<span><span class="co">#&gt;  2:     species    NA Chinstrap 47.12237 42.42971 46.98538 51.48872</span></span>
<span><span class="co">#&gt;  3:     species    NA    Gentoo 44.38067 39.88705 43.85778 51.21616</span></span>
<span><span class="co">#&gt;  4:      island    NA    Biscoe 44.22053 37.22122 45.27023 51.21616</span></span>
<span><span class="co">#&gt;  5:      island    NA     Dream 44.44227 37.03201 45.61137 51.48872</span></span>
<span><span class="co">#&gt;  6:      island    NA Torgersen 43.31009 36.99040 44.32960 49.87707</span></span>
<span><span class="co">#&gt;  7: body_mass_g  3200      &lt;NA&gt; 42.87072 37.03956 44.02023 49.20569</span></span>
<span><span class="co">#&gt;  8: body_mass_g  3550      &lt;NA&gt; 43.57345 37.56123 44.53805 50.46394</span></span>
<span><span class="co">#&gt;  9: body_mass_g  3975      &lt;NA&gt; 44.33545 38.35495 45.24071 51.49108</span></span>
<span><span class="co">#&gt; 10: body_mass_g  4700      &lt;NA&gt; 45.22686 39.90177 46.34731 51.17168</span></span>
<span><span class="co">#&gt; 11: body_mass_g  5300      &lt;NA&gt; 45.91904 40.82776 46.95826 51.47007</span></span></code></pre></div>
<p>And you can also bypass all the bells and whistles by using your own
<code>data.frame</code> for a <code>pred_spec</code>. (Just make sure
you request values that exist in the training data.)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">custom_pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">'Adelie'</span>, </span>
<span>                               island <span class="op">=</span> <span class="st">'Biscoe'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                      pred_spec <span class="op">=</span> <span class="va">custom_pred_spec</span>,</span>
<span>                      new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_new</span></span>
<span><span class="co">#&gt;    species island     mean      lwr     medn      upr</span></span>
<span><span class="co">#&gt;     &lt;fctr&gt; &lt;fctr&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  Adelie Biscoe 41.97228 37.22122 41.60707 48.43226</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="survival">Survival<a class="anchor" aria-label="anchor" href="#survival"></a>
</h3>
<p>Begin by fitting an oblique survival random forest:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">329</span><span class="op">)</span></span>
<span></span>
<span><span class="va">index_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pbc_orsf</span><span class="op">)</span>, <span class="fl">150</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">pbc_orsf_train</span> <span class="op">&lt;-</span> <span class="va">pbc_orsf</span><span class="op">[</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span><span class="va">pbc_orsf_test</span> <span class="op">&lt;-</span> <span class="va">pbc_orsf</span><span class="op">[</span><span class="op">-</span><span class="va">index_train</span>, <span class="op">]</span></span>
<span></span>
<span><span class="va">fit_surv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf.html">orsf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">pbc_orsf_train</span>, </span>
<span>                 formula <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">id</span>,</span>
<span>                 oobag_pred_horizon <span class="op">=</span> <span class="fl">365.25</span> <span class="op">*</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<p>Compute PD using in-bag data for
<code>bili = c(1,2,3,4,5)</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, pred_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bili <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pd_train</span></span>
<span><span class="co">#&gt;    pred_horizon  bili      mean        lwr      medn       upr</span></span>
<span><span class="co">#&gt;           &lt;num&gt; &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      1826.25     1 0.2577640 0.02216336 0.1354828 0.8917942</span></span>
<span><span class="co">#&gt; 2:      1826.25     2 0.3133729 0.06843055 0.1899919 0.9203372</span></span>
<span><span class="co">#&gt; 3:      1826.25     3 0.3715380 0.11484237 0.2596426 0.9416791</span></span>
<span><span class="co">#&gt; 4:      1826.25     4 0.4252787 0.15715950 0.3358026 0.9591581</span></span>
<span><span class="co">#&gt; 5:      1826.25     5 0.4675140 0.20084622 0.3871663 0.9655296</span></span></code></pre></div>
<p>If you don’t have specific values of a variable in mind, let
<code>pred_spec_auto</code> pick for you:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">bili</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pd_train</span></span>
<span><span class="co">#&gt;    pred_horizon  bili      mean        lwr      medn       upr</span></span>
<span><span class="co">#&gt;           &lt;num&gt; &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:      1826.25 0.590 0.2496484 0.02042449 0.1268818 0.8823385</span></span>
<span><span class="co">#&gt; 2:      1826.25 0.725 0.2519816 0.02060212 0.1295009 0.8836536</span></span>
<span><span class="co">#&gt; 3:      1826.25 1.500 0.2810395 0.04002394 0.1614488 0.9040617</span></span>
<span><span class="co">#&gt; 4:      1826.25 3.500 0.3971677 0.13441288 0.2939068 0.9501230</span></span>
<span><span class="co">#&gt; 5:      1826.25 7.210 0.5354697 0.27879513 0.4675994 0.9782084</span></span></code></pre></div>
<p>Specify <code>pred_horizon</code> to get PD at each value:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pd_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">bili</span><span class="op">)</span>,</span>
<span>                        pred_horizon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">3000</span>, by <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pd_train</span></span>
<span><span class="co">#&gt;     pred_horizon  bili       mean          lwr        medn       upr</span></span>
<span><span class="co">#&gt;            &lt;num&gt; &lt;num&gt;      &lt;num&gt;        &lt;num&gt;       &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;  1:          500 0.590 0.06232005 0.0004433990 0.008916421 0.5918463</span></span>
<span><span class="co">#&gt;  2:         1000 0.590 0.14306830 0.0057937418 0.056439901 0.7385612</span></span>
<span><span class="co">#&gt;  3:         1500 0.590 0.20968399 0.0136108776 0.093111650 0.8580445</span></span>
<span><span class="co">#&gt;  4:         2000 0.590 0.26945006 0.0230487039 0.149028935 0.8918696</span></span>
<span><span class="co">#&gt;  5:         2500 0.590 0.31926250 0.0631272096 0.204001583 0.9034059</span></span>
<span><span class="co">#&gt;  6:         3000 0.590 0.39268957 0.0913711930 0.304107973 0.9239494</span></span>
<span><span class="co">#&gt;  7:          500 0.725 0.06302717 0.0004462367 0.009041421 0.5980121</span></span>
<span><span class="co">#&gt;  8:         1000 0.725 0.14433444 0.0063321712 0.056761865 0.7452904</span></span>
<span><span class="co">#&gt;  9:         1500 0.725 0.21166960 0.0140750886 0.094417343 0.8600618</span></span>
<span><span class="co">#&gt; 10:         2000 0.725 0.27177707 0.0235458850 0.149492769 0.8940497</span></span>
<span><span class="co">#&gt; 11:         2500 0.725 0.32039347 0.0626099632 0.203207248 0.9073003</span></span>
<span><span class="co">#&gt; 12:         3000 0.725 0.39542940 0.0913603021 0.309809966 0.9252028</span></span>
<span><span class="co">#&gt; 13:          500 1.500 0.06728168 0.0012717884 0.011414719 0.6244221</span></span>
<span><span class="co">#&gt; 14:         1000 1.500 0.15828495 0.0116391959 0.069145615 0.7685332</span></span>
<span><span class="co">#&gt; 15:         1500 1.500 0.23432627 0.0284592861 0.118184002 0.8792869</span></span>
<span><span class="co">#&gt; 16:         2000 1.500 0.30267446 0.0468287981 0.182754137 0.9143235</span></span>
<span><span class="co">#&gt; 17:         2500 1.500 0.35384592 0.0845460873 0.239239905 0.9265099</span></span>
<span><span class="co">#&gt; 18:         3000 1.500 0.43616999 0.1308798325 0.348503479 0.9438196</span></span>
<span><span class="co">#&gt; 19:          500 3.500 0.08694489 0.0050275033 0.028375762 0.6739715</span></span>
<span><span class="co">#&gt; 20:         1000 3.500 0.22462700 0.0518846442 0.140062134 0.8278986</span></span>
<span><span class="co">#&gt; 21:         1500 3.500 0.32824249 0.0901649908 0.219282772 0.9372373</span></span>
<span><span class="co">#&gt; 22:         2000 3.500 0.41740786 0.1446328597 0.312842740 0.9566091</span></span>
<span><span class="co">#&gt; 23:         2500 3.500 0.49353047 0.2194666498 0.404049236 0.9636221</span></span>
<span><span class="co">#&gt; 24:         3000 3.500 0.56098339 0.2642787647 0.504839107 0.9734948</span></span>
<span><span class="co">#&gt; 25:          500 7.210 0.12603940 0.0220920570 0.063283130 0.7529262</span></span>
<span><span class="co">#&gt; 26:         1000 7.210 0.32672289 0.1353517841 0.260689878 0.8879655</span></span>
<span><span class="co">#&gt; 27:         1500 7.210 0.46434114 0.2181507493 0.387899088 0.9700903</span></span>
<span><span class="co">#&gt; 28:         2000 7.210 0.55142129 0.2913654769 0.487687918 0.9812223</span></span>
<span><span class="co">#&gt; 29:         2500 7.210 0.62016656 0.3705776239 0.568213429 0.9844945</span></span>
<span><span class="co">#&gt; 30:         3000 7.210 0.68028620 0.4249945595 0.644635452 0.9889861</span></span>
<span><span class="co">#&gt;     pred_horizon  bili       mean          lwr        medn       upr</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="one-variable-moving-horizon">One variable, moving horizon<a class="anchor" aria-label="anchor" href="#one-variable-moving-horizon"></a>
</h3>
<p>For the next few sections, we update <code>orsf_fit</code> to include
all the data in <code>pbc_orsf</code> instead of just the training
sample:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a rare case of modify_in_place = TRUE</span></span>
<span><span class="fu"><a href="../reference/orsf_update.html">orsf_update</a></span><span class="op">(</span><span class="va">fit_surv</span>, </span>
<span>            data <span class="op">=</span> <span class="va">pbc_orsf</span>, </span>
<span>            modify_in_place <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_surv</span></span>
<span><span class="co">#&gt; ---------- Oblique random survival forest</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;      Linear combinations: Accelerated Cox regression</span></span>
<span><span class="co">#&gt;           N observations: 276</span></span>
<span><span class="co">#&gt;                 N events: 111</span></span>
<span><span class="co">#&gt;                  N trees: 500</span></span>
<span><span class="co">#&gt;       N predictors total: 17</span></span>
<span><span class="co">#&gt;    N predictors per node: 5</span></span>
<span><span class="co">#&gt;  Average leaves per tree: 21.054</span></span>
<span><span class="co">#&gt; Min observations in leaf: 5</span></span>
<span><span class="co">#&gt;       Min events in leaf: 1</span></span>
<span><span class="co">#&gt;           OOB stat value: 0.84</span></span>
<span><span class="co">#&gt;            OOB stat type: Harrell's C-index</span></span>
<span><span class="co">#&gt;      Variable importance: anova</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -----------------------------------------</span></span></code></pre></div>
<p>What if the effect of a predictor varies over time? Partial
dependence can show this.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pd_sex_tv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_oob</a></span><span class="op">(</span><span class="va">fit_surv</span>, </span>
<span>                         pred_spec <span class="op">=</span> <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span>,</span>
<span>                         pred_horizon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">365</span>, <span class="fl">365</span><span class="op">*</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pd_sex_tv</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred_horizon</span>, y <span class="op">=</span> <span class="va">mean</span>, color <span class="op">=</span> <span class="va">sex</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Time since baseline'</span>,</span>
<span>      y <span class="op">=</span> <span class="st">'Expected risk'</span><span class="op">)</span></span></code></pre></div>
<p><img src="pd_files/figure-html/unnamed-chunk-17-1.png" class="r-plt" width="672"></p>
<p>From inspection, we can see that males have higher risk than females
and the difference in that risk grows over time. This can also be seen
by viewing the ratio of expected risk over time:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">ratio_tv</span> <span class="op">&lt;-</span> <span class="va">pd_sex_tv</span><span class="op">[</span></span>
<span> , <span class="fu">.</span><span class="op">(</span>ratio <span class="op">=</span> <span class="va">mean</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="st">'m'</span><span class="op">]</span> <span class="op">/</span> <span class="va">mean</span><span class="op">[</span><span class="va">sex</span> <span class="op">==</span> <span class="st">'f'</span><span class="op">]</span><span class="op">)</span>, by <span class="op">=</span> <span class="va">pred_horizon</span></span>
<span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ratio_tv</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pred_horizon</span>, y <span class="op">=</span> <span class="va">ratio</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'grey'</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'black'</span>, se <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'time since baseline'</span>,</span>
<span>      y <span class="op">=</span> <span class="st">'ratio in expected risk for males versus females'</span><span class="op">)</span></span></code></pre></div>
<p><img src="pd_files/figure-html/unnamed-chunk-18-1.png" class="r-plt" width="672"></p>
<p>To get a view of PD for any number of variables in the training data,
use <code><a href="../reference/orsf_summarize_uni.html">orsf_summarize_uni()</a></code>. This function computes out-of-bag
PD for the most important <code>n_variables</code> and returns a nicely
formatted view of the output:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pd_smry</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_summarize_uni.html">orsf_summarize_uni</a></span><span class="op">(</span><span class="va">fit_surv</span>, n_variables <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_smry</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- ascites (VI Rank: 1) -------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         |---------------- Risk ----------------|</span></span>
<span><span class="co">#&gt;   Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;  &lt;char&gt;     &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;       0 0.3083824 0.1976324 0.06646301 0.5273443</span></span>
<span><span class="co">#&gt;       1 0.4704989 0.3970363 0.27553488 0.6580071</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- bili (VI Rank: 2) ----------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         |---------------- Risk ----------------|</span></span>
<span><span class="co">#&gt;   Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;  &lt;char&gt;     &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    0.60 0.2357092 0.1549629 0.05915593 0.3743946</span></span>
<span><span class="co">#&gt;    0.80 0.2398425 0.1614950 0.06166665 0.3783214</span></span>
<span><span class="co">#&gt;    1.40 0.2613221 0.1797317 0.07964665 0.4055408</span></span>
<span><span class="co">#&gt;    3.52 0.3700279 0.3112071 0.16940969 0.5462945</span></span>
<span><span class="co">#&gt;    7.25 0.4777720 0.4395811 0.29387029 0.6455815</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- edema (VI Rank: 3) ---------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         |---------------- Risk ----------------|</span></span>
<span><span class="co">#&gt;   Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;  &lt;char&gt;     &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;       0 0.3034807 0.1837458 0.06596455 0.5245902</span></span>
<span><span class="co">#&gt;     0.5 0.3561490 0.2640797 0.11226302 0.5851187</span></span>
<span><span class="co">#&gt;       1 0.4692705 0.3977953 0.28170668 0.6358042</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -- copper (VI Rank: 4) --------------------------</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;         |---------------- Risk ----------------|</span></span>
<span><span class="co">#&gt;   Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;  &lt;char&gt;     &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    25.5 0.2633274 0.1607974 0.05583931 0.4291773</span></span>
<span><span class="co">#&gt;    42.8 0.2706977 0.1693998 0.05899535 0.4414023</span></span>
<span><span class="co">#&gt;    74.0 0.2908078 0.1932930 0.07193260 0.4760612</span></span>
<span><span class="co">#&gt;     129 0.3445538 0.2640739 0.12036446 0.5580919</span></span>
<span><span class="co">#&gt;     214 0.4242290 0.3581846 0.21435583 0.6264875</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Predicted risk at time t = 1826.25 for top 4 predictors</span></span></code></pre></div>
<p>This ‘summary’ object can be converted into a <code>data.table</code>
for downstream plotting and tables.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">pd_smry</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    variable importance  Value      Mean    Median     25th %    75th %</span></span>
<span><span class="co">#&gt;      &lt;char&gt;      &lt;num&gt; &lt;char&gt;     &lt;num&gt;     &lt;num&gt;      &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:  ascites   0.495098      0 0.3083824 0.1976324 0.06646301 0.5273443</span></span>
<span><span class="co">#&gt; 2:  ascites   0.495098      1 0.4704989 0.3970363 0.27553488 0.6580071</span></span>
<span><span class="co">#&gt; 3:     bili   0.415506   0.60 0.2357092 0.1549629 0.05915593 0.3743946</span></span>
<span><span class="co">#&gt; 4:     bili   0.415506   0.80 0.2398425 0.1614950 0.06166665 0.3783214</span></span>
<span><span class="co">#&gt; 5:     bili   0.415506   1.40 0.2613221 0.1797317 0.07964665 0.4055408</span></span>
<span><span class="co">#&gt; 6:     bili   0.415506   3.52 0.3700279 0.3112071 0.16940969 0.5462945</span></span>
<span><span class="co">#&gt;    pred_horizon  level</span></span>
<span><span class="co">#&gt;           &lt;num&gt; &lt;char&gt;</span></span>
<span><span class="co">#&gt; 1:      1826.25      0</span></span>
<span><span class="co">#&gt; 2:      1826.25      1</span></span>
<span><span class="co">#&gt; 3:      1826.25   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4:      1826.25   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5:      1826.25   &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6:      1826.25   &lt;NA&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="multiple-variables-jointly">Multiple variables, jointly<a class="anchor" aria-label="anchor" href="#multiple-variables-jointly"></a>
</h3>
<p>Partial dependence can show the expected value of a model’s
predictions as a function of a specific predictor, or as a function of
multiple predictors. For instance, we can estimate predicted risk as a
joint function of <code>bili</code>, <code>edema</code>, and
<code>trt</code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pred_spec</span> <span class="op">=</span> <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">bili</span>, <span class="va">edema</span>, <span class="va">trt</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pd_bili_edema</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_pd_oob.html">orsf_pd_oob</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="va">pred_spec</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pd_bili_edema</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bili</span>, y <span class="op">=</span> <span class="va">medn</span>, col <span class="op">=</span> <span class="va">trt</span>, linetype <span class="op">=</span> <span class="va">edema</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">'Expected predicted risk'</span><span class="op">)</span></span></code></pre></div>
<p><img src="pd_files/figure-html/unnamed-chunk-21-1.png" class="r-plt" width="672"></p>
<p>From inspection,</p>
<ul>
<li><p>the model’s predictions indicate slightly lower risk for the
placebo group, and these do not seem to change much at different values
of <code>bili</code> or <code>edema</code>.</p></li>
<li><p>There is a clear increase in predicted risk with higher levels of
<code>edema</code> and with higher levels of <code>bili</code></p></li>
<li>
<p>the slope of predicted risk as a function of <code>bili</code>
appears highest among patients with <code>edema</code> of 0.5. Is the
effect of <code>bili</code> modified by <code>edema</code> being 0.5? A
quick sanity check with <code>coxph</code> suggests there is.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pbc_orsf</span><span class="op">$</span><span class="va">edema_05</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">pbc_orsf</span><span class="op">$</span><span class="va">edema</span> <span class="op">==</span> <span class="st">'0.5'</span>, <span class="st">'yes'</span>, <span class="st">'no'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_cph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">edema_05</span> <span class="op">*</span> <span class="va">bili</span>, </span>
<span>                 data <span class="op">=</span> <span class="va">pbc_orsf</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fit_cph</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Deviance Table</span></span>
<span><span class="co">#&gt;  Cox model: response is Surv(time, status)</span></span>
<span><span class="co">#&gt; Terms added sequentially (first to last)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                loglik   Chisq Df Pr(&gt;|Chi|)    </span></span>
<span><span class="co">#&gt; NULL          -550.19                          </span></span>
<span><span class="co">#&gt; edema_05      -546.83  6.7248  1   0.009508 ** </span></span>
<span><span class="co">#&gt; bili          -513.59 66.4689  1  3.555e-16 ***</span></span>
<span><span class="co">#&gt; edema_05:bili -510.54  6.1112  1   0.013433 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</li>
</ul>
</div>
<div class="section level3">
<h3 id="find-interactions-using-pd">Find interactions using PD<a class="anchor" aria-label="anchor" href="#find-interactions-using-pd"></a>
</h3>
<p>Random forests are good at using interactions, but less good at
telling you about them. Use <code><a href="../reference/orsf_vint.html">orsf_vint()</a></code> to apply the method
for variable interaction scoring with PD described by Greenwell et al
(2018). This can take a little while if you have lots of predictors, and
it seems to work best with continuous by continuous interactions.
Interactions with categorical variables are sometimes over- or under-
scored.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># use just the continuous variables</span></span>
<span><span class="va">preds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fit_surv</span><span class="op">$</span><span class="fu">get_means</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vint_scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_vint.html">orsf_vint</a></span><span class="op">(</span><span class="va">fit_surv</span>, predictors <span class="op">=</span> <span class="va">preds</span><span class="op">)</span></span>
<span></span>
<span><span class="va">vint_scores</span></span>
<span><span class="co">#&gt;            interaction      score          pd_values</span></span>
<span><span class="co">#&gt;                 &lt;char&gt;      &lt;num&gt;             &lt;list&gt;</span></span>
<span><span class="co">#&gt;  1:   albumin..protime 1.14372345 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt;  2:    copper..protime 0.80309032 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt;  3:          age..bili 0.73357275 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt;  4:         bili..chol 0.73252929 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt;  5:      bili..albumin 0.70643095 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt;  6:       bili..copper 0.67416633 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt;  7:      bili..protime 0.59083419 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt;  8:       albumin..ast 0.58037703 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt;  9:     bili..platelet 0.57526259 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 10:       ast..protime 0.56012640 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 11:    albumin..copper 0.55218459 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 12:         bili..trig 0.50503081 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 13:       copper..trig 0.50326606 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 14:       age..protime 0.44416065 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 15:           age..ast 0.44275346 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 16:      age..platelet 0.42914892 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 17:  albumin..platelet 0.39857906 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 18:      chol..albumin 0.39471243 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 19:  platelet..protime 0.37888733 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 20:        age..copper 0.37279146 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 21:        copper..ast 0.34537264 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 22:      trig..protime 0.30521235 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 23:     bili..alk.phos 0.26690958 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 24:      chol..protime 0.24219208 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 25:   copper..alk.phos 0.22559565 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 26:          bili..ast 0.21920801 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 27:         chol..trig 0.20371295 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 28:     trig..platelet 0.18406973 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 29:      age..alk.phos 0.18050333 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 30:       chol..copper 0.16965068 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 31:   copper..platelet 0.15446709 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 32:       age..albumin 0.14375725 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 33:     alk.phos..trig 0.13937527 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 34:          age..trig 0.12629526 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 35:  albumin..alk.phos 0.11053103 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 36:          chol..ast 0.10492142 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 37:     chol..alk.phos 0.10097621 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 38:      ast..platelet 0.09422188 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 39:      alk.phos..ast 0.08279236 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 40:  alk.phos..protime 0.07977162 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 41:          ast..trig 0.07030654 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 42:          age..chol 0.05924894 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 43:      albumin..trig 0.04913426 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 44: alk.phos..platelet 0.04672433 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt; 45:     chol..platelet 0.04641934 &lt;data.table[25x9]&gt;</span></span>
<span><span class="co">#&gt;            interaction      score          pd_values</span></span></code></pre></div>
<p>The scores include partial dependence values that you can pull out
and plot:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># top scoring interaction</span></span>
<span><span class="va">pd_top</span> <span class="op">&lt;-</span> <span class="va">vint_scores</span><span class="op">$</span><span class="va">pd_values</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># center pd values so it's easier to see the interaction effect</span></span>
<span><span class="va">pd_top</span><span class="op">[</span>, <span class="va">mean</span> <span class="op">:=</span> <span class="va">mean</span> <span class="op">-</span> <span class="va">mean</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, by <span class="op">=</span> <span class="va">var_2_value</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pd_top</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">var_1_value</span>, </span>
<span>     y <span class="op">=</span> <span class="va">mean</span>, </span>
<span>     color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">var_2_value</span><span class="op">)</span>, </span>
<span>     group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">var_2_value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"albumin"</span>, </span>
<span>      y <span class="op">=</span> <span class="st">"predicted mortality (centered)"</span>,</span>
<span>      color <span class="op">=</span> <span class="st">"protime"</span><span class="op">)</span></span></code></pre></div>
<p><img src="pd_files/figure-html/unnamed-chunk-25-1.png" class="r-plt" width="672"></p>
<p>Again we use a sanity check with <code>coxph</code> to see if these
interactions are detected using a standard test:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># test the top score (expect strong interaction)</span></span>
<span><span class="va">fit_cph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">albumin</span> <span class="op">*</span> <span class="va">protime</span>, </span>
<span>                 data <span class="op">=</span> <span class="va">pbc_orsf</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">fit_cph</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of Deviance Table</span></span>
<span><span class="co">#&gt;  Cox model: response is Surv(time, status)</span></span>
<span><span class="co">#&gt; Terms added sequentially (first to last)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  loglik  Chisq Df Pr(&gt;|Chi|)    </span></span>
<span><span class="co">#&gt; NULL            -550.19                         </span></span>
<span><span class="co">#&gt; albumin         -526.29 47.801  1  4.717e-12 ***</span></span>
<span><span class="co">#&gt; protime         -514.89 22.806  1  1.792e-06 ***</span></span>
<span><span class="co">#&gt; albumin:protime -511.76  6.252  1    0.01241 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p><em>Note</em>: Caution is warranted when interpreting statistical
hypotheses that are motivated by the same data they are tested with.
Results like the p-values for interaction shown above should be
interpreted as exploratory.</p>
</div>
</div>
<div class="section level2">
<h2 id="individual-conditional-expectations-ice">Individual conditional expectations (ICE)<a class="anchor" aria-label="anchor" href="#individual-conditional-expectations-ice"></a>
</h2>
<p>Unlike partial dependence, which shows the expected prediction as a
function of one or multiple predictors, individual conditional
expectations (ICE) show the prediction for an individual observation as
a function of a predictor.</p>
<div class="section level3">
<h3 id="classification-1">Classification<a class="anchor" aria-label="anchor" href="#classification-1"></a>
</h3>
<p>Compute ICE using out-of-bag data for
<code>flipper_length_mm = c(190, 210)</code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">190</span>, <span class="fl">210</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_oob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_oob</a></span><span class="op">(</span><span class="va">fit_clsf</span>, pred_spec <span class="op">=</span> <span class="va">pred_spec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_oob</span></span>
<span><span class="co">#&gt; Key: &lt;class&gt;</span></span>
<span><span class="co">#&gt;      id_variable id_row  class flipper_length_mm       pred</span></span>
<span><span class="co">#&gt;            &lt;int&gt; &lt;char&gt; &lt;fctr&gt;             &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:           1      1 Adelie               190 0.91786072</span></span>
<span><span class="co">#&gt;   2:           1      2 Adelie               190 0.80692442</span></span>
<span><span class="co">#&gt;   3:           1      3 Adelie               190 0.84373775</span></span>
<span><span class="co">#&gt;   4:           1      4 Adelie               190 0.93581356</span></span>
<span><span class="co">#&gt;   5:           1      5 Adelie               190 0.97646782</span></span>
<span><span class="co">#&gt;  ---                                                       </span></span>
<span><span class="co">#&gt; 896:           2    146 Gentoo               210 0.26825373</span></span>
<span><span class="co">#&gt; 897:           2    147 Gentoo               210 0.04678383</span></span>
<span><span class="co">#&gt; 898:           2    148 Gentoo               210 0.08082570</span></span>
<span><span class="co">#&gt; 899:           2    149 Gentoo               210 0.84364362</span></span>
<span><span class="co">#&gt; 900:           2    150 Gentoo               210 0.11149972</span></span></code></pre></div>
<p>There are two identifiers in the output:</p>
<ul>
<li><p><code>id_variable</code> is an identifier for the current value
of the variable(s) that are in the data. It is redundant if you only
have one variable, but helpful if there are multiple variables.</p></li>
<li><p><code>id_row</code> is an identifier for the observation in the
original data.</p></li>
</ul>
<p>Note that predicted probabilities are returned for each class and
each observation in the data. Predicted probabilities for a given
observation and given variable value sum to 1. For example,</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ice_oob</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span> <span class="va">.</span><span class="op">[</span><span class="va">flipper_length_mm</span> <span class="op">==</span> <span class="fl">190</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span> <span class="va">.</span><span class="op">[</span><span class="va">id_row</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span> <span class="va">.</span><span class="op">[[</span><span class="st">'pred'</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; [1] 1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="regression-1">Regression<a class="anchor" aria-label="anchor" href="#regression-1"></a>
</h3>
<p>Compute ICE using new data for
<code>flipper_length_mm = c(190, 210)</code>.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>flipper_length_mm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">190</span>, <span class="fl">210</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                        pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                        new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span></span>
<span><span class="co">#&gt;      id_variable id_row flipper_length_mm     pred</span></span>
<span><span class="co">#&gt;            &lt;int&gt; &lt;char&gt;             &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:           1      1               190 37.96728</span></span>
<span><span class="co">#&gt;   2:           1      2               190 37.59330</span></span>
<span><span class="co">#&gt;   3:           1      3               190 37.52653</span></span>
<span><span class="co">#&gt;   4:           1      4               190 39.43966</span></span>
<span><span class="co">#&gt;   5:           1      5               190 38.89585</span></span>
<span><span class="co">#&gt;  ---                                              </span></span>
<span><span class="co">#&gt; 362:           2    179               210 51.84047</span></span>
<span><span class="co">#&gt; 363:           2    180               210 47.32206</span></span>
<span><span class="co">#&gt; 364:           2    181               210 47.11685</span></span>
<span><span class="co">#&gt; 365:           2    182               210 50.35878</span></span>
<span><span class="co">#&gt; 366:           2    183               210 48.47516</span></span></code></pre></div>
<p>You can also let <code>pred_spec_auto</code> pick reasonable values
like so:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pred_spec</span> <span class="op">=</span> <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">island</span>, <span class="va">body_mass_g</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                        pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                        new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span></span>
<span><span class="co">#&gt;       id_variable id_row species    island body_mass_g     pred</span></span>
<span><span class="co">#&gt;             &lt;int&gt; &lt;char&gt;  &lt;fctr&gt;    &lt;fctr&gt;       &lt;num&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:           1      1  Adelie    Biscoe        3200 37.77367</span></span>
<span><span class="co">#&gt;    2:           1      2  Adelie    Biscoe        3200 37.74208</span></span>
<span><span class="co">#&gt;    3:           1      3  Adelie    Biscoe        3200 37.71838</span></span>
<span><span class="co">#&gt;    4:           1      4  Adelie    Biscoe        3200 40.24397</span></span>
<span><span class="co">#&gt;    5:           1      5  Adelie    Biscoe        3200 40.03858</span></span>
<span><span class="co">#&gt;   ---                                                          </span></span>
<span><span class="co">#&gt; 8231:          45    179  Gentoo Torgersen        5300 46.17488</span></span>
<span><span class="co">#&gt; 8232:          45    180  Gentoo Torgersen        5300 43.98226</span></span>
<span><span class="co">#&gt; 8233:          45    181  Gentoo Torgersen        5300 44.64290</span></span>
<span><span class="co">#&gt; 8234:          45    182  Gentoo Torgersen        5300 44.85696</span></span>
<span><span class="co">#&gt; 8235:          45    183  Gentoo Torgersen        5300 44.24532</span></span></code></pre></div>
<p>By default, all combinations of all variables are used. However, you
can also look at the variables one by one, separately, like so:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ice_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                        expand_grid <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        pred_spec <span class="op">=</span> <span class="va">pred_spec</span>,</span>
<span>                        new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span></span>
<span><span class="co">#&gt;       id_variable id_row    variable value  level     pred</span></span>
<span><span class="co">#&gt;             &lt;int&gt; &lt;char&gt;      &lt;char&gt; &lt;num&gt; &lt;char&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:           1      1     species    NA Adelie 37.76987</span></span>
<span><span class="co">#&gt;    2:           1      2     species    NA Adelie 37.42067</span></span>
<span><span class="co">#&gt;    3:           1      3     species    NA Adelie 37.02215</span></span>
<span><span class="co">#&gt;    4:           1      4     species    NA Adelie 39.86238</span></span>
<span><span class="co">#&gt;    5:           1      5     species    NA Adelie 39.13934</span></span>
<span><span class="co">#&gt;   ---                                                     </span></span>
<span><span class="co">#&gt; 2009:           5    179 body_mass_g  5300   &lt;NA&gt; 51.48398</span></span>
<span><span class="co">#&gt; 2010:           5    180 body_mass_g  5300   &lt;NA&gt; 47.38554</span></span>
<span><span class="co">#&gt; 2011:           5    181 body_mass_g  5300   &lt;NA&gt; 48.37088</span></span>
<span><span class="co">#&gt; 2012:           5    182 body_mass_g  5300   &lt;NA&gt; 48.73581</span></span>
<span><span class="co">#&gt; 2013:           5    183 body_mass_g  5300   &lt;NA&gt; 48.15788</span></span></code></pre></div>
<p>And you can also bypass all the bells and whistles by using your own
<code>data.frame</code> for a <code>pred_spec</code>. (Just make sure
you request values that exist in the training data.)</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">custom_pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">'Adelie'</span>, </span>
<span>                               island <span class="op">=</span> <span class="st">'Biscoe'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_new</a></span><span class="op">(</span><span class="va">fit_regr</span>, </span>
<span>                        pred_spec <span class="op">=</span> <span class="va">custom_pred_spec</span>,</span>
<span>                        new_data <span class="op">=</span> <span class="va">penguins_orsf_test</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_new</span></span>
<span><span class="co">#&gt;      id_variable id_row species island     pred</span></span>
<span><span class="co">#&gt;            &lt;int&gt; &lt;char&gt;  &lt;fctr&gt; &lt;fctr&gt;    &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:           1      1  Adelie Biscoe 38.59664</span></span>
<span><span class="co">#&gt;   2:           1      2  Adelie Biscoe 38.39163</span></span>
<span><span class="co">#&gt;   3:           1      3  Adelie Biscoe 37.71838</span></span>
<span><span class="co">#&gt;   4:           1      4  Adelie Biscoe 41.60707</span></span>
<span><span class="co">#&gt;   5:           1      5  Adelie Biscoe 40.87682</span></span>
<span><span class="co">#&gt;  ---                                           </span></span>
<span><span class="co">#&gt; 179:           1    179  Adelie Biscoe 43.27313</span></span>
<span><span class="co">#&gt; 180:           1    180  Adelie Biscoe 38.79168</span></span>
<span><span class="co">#&gt; 181:           1    181  Adelie Biscoe 39.36983</span></span>
<span><span class="co">#&gt; 182:           1    182  Adelie Biscoe 40.70338</span></span>
<span><span class="co">#&gt; 183:           1    183  Adelie Biscoe 39.34160</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="survival-1">Survival<a class="anchor" aria-label="anchor" href="#survival-1"></a>
</h3>
<p>Compute ICE using in-bag data for
<code>bili = c(1,2,3,4,5)</code>:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ice_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, pred_spec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bili <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ice_train</span></span>
<span><span class="co">#&gt;       id_variable id_row pred_horizon  bili      pred</span></span>
<span><span class="co">#&gt;             &lt;int&gt; &lt;char&gt;        &lt;num&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:           1      1      1826.25     1 0.9016496</span></span>
<span><span class="co">#&gt;    2:           1      2      1826.25     1 0.1037440</span></span>
<span><span class="co">#&gt;    3:           1      3      1826.25     1 0.6827508</span></span>
<span><span class="co">#&gt;    4:           1      4      1826.25     1 0.3649341</span></span>
<span><span class="co">#&gt;    5:           1      5      1826.25     1 0.1359036</span></span>
<span><span class="co">#&gt;   ---                                                </span></span>
<span><span class="co">#&gt; 1376:           5    272      1826.25     5 0.2652313</span></span>
<span><span class="co">#&gt; 1377:           5    273      1826.25     5 0.3052097</span></span>
<span><span class="co">#&gt; 1378:           5    274      1826.25     5 0.3472418</span></span>
<span><span class="co">#&gt; 1379:           5    275      1826.25     5 0.1654495</span></span>
<span><span class="co">#&gt; 1380:           5    276      1826.25     5 0.3580860</span></span></code></pre></div>
<p>If you don’t have specific values of a variable in mind, let
<code>pred_spec_auto</code> pick for you:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ice_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">bili</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ice_train</span></span>
<span><span class="co">#&gt;       id_variable id_row pred_horizon  bili       pred</span></span>
<span><span class="co">#&gt;             &lt;int&gt; &lt;char&gt;        &lt;num&gt; &lt;num&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:           1      1      1826.25  0.60 0.89223774</span></span>
<span><span class="co">#&gt;    2:           1      2      1826.25  0.60 0.09152018</span></span>
<span><span class="co">#&gt;    3:           1      3      1826.25  0.60 0.65439019</span></span>
<span><span class="co">#&gt;    4:           1      4      1826.25  0.60 0.35024896</span></span>
<span><span class="co">#&gt;    5:           1      5      1826.25  0.60 0.13158081</span></span>
<span><span class="co">#&gt;   ---                                                 </span></span>
<span><span class="co">#&gt; 1376:           5    272      1826.25  7.25 0.31167841</span></span>
<span><span class="co">#&gt; 1377:           5    273      1826.25  7.25 0.35346468</span></span>
<span><span class="co">#&gt; 1378:           5    274      1826.25  7.25 0.41551777</span></span>
<span><span class="co">#&gt; 1379:           5    275      1826.25  7.25 0.25348167</span></span>
<span><span class="co">#&gt; 1380:           5    276      1826.25  7.25 0.44843575</span></span></code></pre></div>
<p>Specify <code>pred_horizon</code> to get ICE at each value:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ice_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_inb</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="fu"><a href="../reference/pred_spec_auto.html">pred_spec_auto</a></span><span class="op">(</span><span class="va">bili</span><span class="op">)</span>,</span>
<span>                          pred_horizon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">500</span>, <span class="fl">3000</span>, by <span class="op">=</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ice_train</span></span>
<span><span class="co">#&gt;       id_variable id_row pred_horizon  bili      pred</span></span>
<span><span class="co">#&gt;             &lt;int&gt; &lt;char&gt;        &lt;num&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:           1      1          500  0.60 0.5981186</span></span>
<span><span class="co">#&gt;    2:           1      1         1000  0.60 0.7663280</span></span>
<span><span class="co">#&gt;    3:           1      1         1500  0.60 0.8756413</span></span>
<span><span class="co">#&gt;    4:           1      1         2000  0.60 0.9058468</span></span>
<span><span class="co">#&gt;    5:           1      1         2500  0.60 0.9233248</span></span>
<span><span class="co">#&gt;   ---                                                </span></span>
<span><span class="co">#&gt; 8276:           5    276         1000  7.25 0.2139627</span></span>
<span><span class="co">#&gt; 8277:           5    276         1500  7.25 0.3669895</span></span>
<span><span class="co">#&gt; 8278:           5    276         2000  7.25 0.4864812</span></span>
<span><span class="co">#&gt; 8279:           5    276         2500  7.25 0.5737099</span></span>
<span><span class="co">#&gt; 8280:           5    276         3000  7.25 0.6223523</span></span></code></pre></div>
<p>Multi-prediction horizon ice comes with minimal extra computational
cost. Use a fine grid of time values and assess whether predictors have
time-varying effects.</p>
</div>
<div class="section level3">
<h3 id="visualizing-ice-curves">Visualizing ICE curves<a class="anchor" aria-label="anchor" href="#visualizing-ice-curves"></a>
</h3>
<p>Inspecting the ICE curves for each observation can help identify
whether there is heterogeneity in a model’s predictions. I.e., does the
effect of the variable follow the same pattern for all the data, or are
there groups where the variable impacts risk differently?</p>
<p>I am going to turn off boundary checking in <code>orsf_ice_oob</code>
by setting <code>boundary_checks = FALSE</code>, and this will allow me
to generate ICE curves that go beyond the 90th percentile of
<code>bili</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pred_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>bili <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span>, length.out <span class="op">=</span> <span class="fl">25</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_oob</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/orsf_ice_oob.html">orsf_ice_oob</a></span><span class="op">(</span><span class="va">fit_surv</span>, <span class="va">pred_spec</span>, boundary_checks <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ice_oob</span></span>
<span><span class="co">#&gt;       id_variable id_row pred_horizon  bili      pred</span></span>
<span><span class="co">#&gt;             &lt;int&gt; &lt;char&gt;        &lt;num&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">#&gt;    1:           1      1      1826.25     1 0.8794334</span></span>
<span><span class="co">#&gt;    2:           1      2      1826.25     1 0.8132035</span></span>
<span><span class="co">#&gt;    3:           1      3      1826.25     1 0.6288688</span></span>
<span><span class="co">#&gt;    4:           1      4      1826.25     1 0.7516217</span></span>
<span><span class="co">#&gt;    5:           1      5      1826.25     1 0.5769346</span></span>
<span><span class="co">#&gt;   ---                                                </span></span>
<span><span class="co">#&gt; 6896:          25    272      1826.25    10 0.7018976</span></span>
<span><span class="co">#&gt; 6897:          25    273      1826.25    10 0.4603795</span></span>
<span><span class="co">#&gt; 6898:          25    274      1826.25    10 0.3351318</span></span>
<span><span class="co">#&gt; 6899:          25    275      1826.25    10 0.6014643</span></span>
<span><span class="co">#&gt; 6900:          25    276      1826.25    10 0.2780788</span></span></code></pre></div>
<p>For plots, it is helpful to scale the ICE data. I subtract the
initial value of predicted risk (i.e., when <code>bili = 1</code>) from
each observation’s conditional expectation values. So,</p>
<ul>
<li><p>Every curve start at 0</p></li>
<li>
<p>The plot shows <em>change</em> in predicted risk as a function of
<code>bili</code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">ice_oob</span><span class="op">[</span>, <span class="va">pred_subtract</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">pred</span><span class="op">[</span><span class="va">id_variable</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span>, times<span class="op">=</span><span class="fl">25</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">ice_oob</span><span class="op">[</span>, <span class="va">pred</span> <span class="op">:=</span> <span class="va">pred</span> <span class="op">-</span> <span class="va">pred_subtract</span><span class="op">]</span></span></code></pre></div>
</li>
</ul>
<p>Now we can visualize the curves.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ice_oob</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bili</span>, </span>
<span>                    y <span class="op">=</span> <span class="va">pred</span>, </span>
<span>                    group <span class="op">=</span> <span class="va">id_row</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span> </span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">'Change in predicted risk'</span><span class="op">)</span> <span class="op">+</span></span>
<span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html" class="external-link">geom_smooth</a></span><span class="op">(</span>se <span class="op">=</span> <span class="cn">FALSE</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="pd_files/figure-html/-orsf_ice-1.png" class="r-plt" width="672"></p>
<p>From inspection of the figure,</p>
<ul>
<li><p>Most of the individual slopes cluster around the overall trend -
Good!</p></li>
<li><p>A small number of individual slopes appear to be flat. It may be
helpful to investigate this further.</p></li>
</ul>
</div>
<div class="section level3">
<h3 id="limitations-of-pd">Limitations of PD<a class="anchor" aria-label="anchor" href="#limitations-of-pd"></a>
</h3>
<p>Partial dependence has a number of <a href="https://christophm.github.io/interpretable-ml-book/pdp.html#disadvantages-5" class="external-link">known
limitations and assumptions</a> that users should be aware of (see
Hooker, 2021). In particular, partial dependence is less intuitive when
&gt;2 predictors are examined jointly, and it is assumed that the
feature(s) for which the partial dependence is computed are not
correlated with other features (this is likely not true in many cases).
Accumulated local effect plots can be used (see <a href="https://christophm.github.io/interpretable-ml-book/ale.html" class="external-link">here</a>)
in the case where feature independence is not a valid assumption.</p>
</div>
<div class="section level3">
<h3 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Hooker, Giles, Mentch, Lucas, Zhou, Siyu (2021). “Unrestricted
permutation forces extrapolation: variable importance requires at least
one more model, or there is no free variable importance.” <em>Statistics
and Computing</em>, <em>31</em>, 1-16.</li>
</ol>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Byron Jaeger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
